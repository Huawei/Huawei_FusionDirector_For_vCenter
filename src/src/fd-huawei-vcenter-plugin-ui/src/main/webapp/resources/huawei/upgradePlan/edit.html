<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>修改计划</title>
    <link href="../../css/element.css" rel="stylesheet" />
    <link href="../../css/style.css" rel="stylesheet" />
    <script src="../../scripts/vue.js"></script>
    <script src="../../scripts/element.js"></script>
    <script src="../../scripts/jquery-3.2.1.min.js"></script>
    <script src="../../scripts/i18n/zh-CN.js"></script>
    <script src="../../scripts/i18n/en.js"></script>
    <script src="../i18n/en.js"></script>
    <script src="../i18n/zh-CN.js"></script>
    <script src="../../scripts/polyfill.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../../scripts/web-platform.js"></script>
    <script src="../js/errorCode.js"></script>
    <script src="../js/taskMessage.js"></script>
    <script src="../../scripts/lodash.min.js"></script>
    <script src="js/rest.js"></script>
    <script src="js/inputnum.js"></script>
    <script src="js/partial.js"></script>
    <script src="js/deviceInfo.js"></script>
    <script src="js/serverTable.js"></script>
    <script src="js/managerTable.js"></script>
    <script src="js/switchTable.js"></script>
    <script src="js/fanTable.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }

        body {
            min-width: 900px;
        }

        .checkText {
            color: #999;
        }

        .checkText i {
            font-style: normal;
        }

        .checkText .descTo {
            color: #409eff;
            cursor: pointer;
            margin-right: 5px;
        }

        .el-icon-info {
            margin-right: 10px;
            color: #409eff;
        }

        .el-input-number span {
            background-color: #fff;
        }

        .steps {
            padding: 20px;
        }

        .mt20 {
            margin: 20px 0;
        }

        .switch {
            margin-left: 10px;
            display: inline-block;
        }

        .fl {
            float: left;
        }

        .checkVisForm .el-upload-list {
            width: 450px;
        }

        .checkVisForm .el-select {
            width: 420px;
        }

        .checkVisForm .el-input,
        .checkVisForm .el-textarea__inner {
            width: 420px;
        }

        .checkVisForm .el-upload-list {
            width: 420px;
        }

        .desLength {
            position: absolute;
            bottom: 0px;
            left: 360px;
            color: #999;
            width: 50px;
            text-align: right;
        }

        /* 部署的下拉搜索框 */
        .input-with-select {
            display: inline-block;
            position: relative;
            vertical-align: middle;
        }

        .input-with-select .el-select {
            width: auto;
        }

        .input-with-select .el-select .el-input {
            width: 130px;
        }

        .serviceTit {
            display: inline-block;
            height: 30px;
            line-height: 30px;
            vertical-align: middle;
            margin-right: 10px;
        }

        .serviceTit i {
            width: 5px;
            height: 100%;
            background: #409eff;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }

        .radioDesc {
            color: #999;
            margin-left: 10px;
        }

        .add_table_header .el-checkbox__inner {
            display: none;
        }

        .packageSearch {
            margin-bottom: 10px;
        }

        .group_table_header .el-checkbox__inner,
        .device_table_header .el-checkbox__inner {
            cursor: not-allowed;
            background: #edf2fc;
        }

        .productType .el-form-item__label:before {
            content: '*';
            color: #f56c6c;
            margin-right: 3px;
        }

        .packageSearch .el-select-multiple {
            min-width: 500px;
        }

        .el-dialog {
            min-width: 830px;
        }

        .upgradePlan_importAddDevice {
            overflow: hidden;
            height: auto;
            width: 100%;
            background: #f6f7f8;
            margin-top: 60px;
            padding: 30px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

        .itemUpgrade {
            margin: 20px 40px 30px 30px;
            padding: 10px;
            width: 180px;
            height: 110px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fff;
            float: left;
            position: relative;
            box-sizing: border-box;
        }

        .upgradePlan_importAddDevice .optionIcon {
            float: right;
            cursor: pointer;
            color: #409eff;
            margin-right: 5px;
        }

        .upgradePlan_importAddDevice .optionIcon i {
            font-size: 18px;
        }

        .rightImg {
            position: absolute;
            top: 25px;
            right: -60px;
        }

        .inputNum {
            position: relative;
            display: inline-block;
            width: 180px;
            line-height: 38px;
        }

        .inputNum .reduce {
            position: absolute;
            z-index: 1;
            top: 1px;
            left: 1px;
            width: 40px;
            height: auto;
            text-align: center;
            background: #f5f7fa;
            color: #606266;
            cursor: pointer;
            font-size: 23px;
            border-radius: 4px 0 0 4px;
            border-right: 1px solid #dcdfe6;
            display: inline-block;
            vertical-align: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .inputNum .add {
            position: absolute;
            z-index: 1;
            top: 1px;
            right: 1px;
            width: 40px;
            height: auto;
            text-align: center;
            background: #f5f7fa;
            color: #606266;
            cursor: pointer;
            font-size: 23px;
            border-radius: 0 4px 4px 0;
            border-left: 1px solid #dcdfe6;
            display: inline-block;
            vertical-align: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .inputNum .input {
            background-color: #fff;
            background-image: none;
            border-radius: 4px;
            border: 1px solid #dcdfe6;
            box-sizing: border-box;
            color: #606266;
            display: inline-block;
            font-size: inherit;
            height: 40px;
            line-height: 40px;
            outline: none;
            padding: 0 15px;
            transition: border-color .2s cubic-bezier(.645, .045, .355, 1);
            width: 100%;
            -webkit-appearance: none;
            padding-left: 50px;
            padding-right: 50px;
            text-align: center;
        }

        .row-expand-cover .el-table__expand-column .el-icon {
            visibility: hidden;
        }

        .hide-padding+tr .el-table__expanded-cell {
            padding: 0;
            padding-left: 100px;
            border: none;
        }
        .detailDevice .hide-padding+tr .el-table__expanded-cell {
            padding: 0;
            padding-left: 46px;
            border: none;
        }
        .packageSearch .el-select-multipleauto {
            min-width: 410px;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <el-row v-loading.fullscreen.lock="editLoading">
            <div>
                <el-row>
                    <h2>{{i18ns.upgradePackage.infoMessage}}</h2>
                </el-row>
                <!-- 选择版本 -->
                <el-row>
                    <el-form class="checkVisForm" v-bind:model="upgradeForm" v-bind:rules="rules" ref="upgradeForm"
                        v-bind:label-width="labelWidth" label-position="left" label-suffix=":">
                        <div class="com-border-bottom">
                            <el-form-item label="Fusion Director ">
                                <el-select v-model="FDIp" @change="commandClick" disabled>
                                    <el-option v-for="item in FDList" :key="item.value" :label="item.label"
                                        :value="item.value">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_planName" prop="PlanName">
                                <el-popover placement="right-start" trigger="hover"
                                    :content="i18ns.common.regExp_userName">
                                    <el-input slot="reference" :placeholder="i18ns.common.pleaseInput"
                                        v-model="upgradeForm.PlanName" class="input-with-select"></el-input>
                                </el-popover>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_planDescription" prop="Description">
                                <el-input :rows="5" type="textarea" v-model="upgradeForm.Description" maxlength="256"
                                    :placeholder="i18ns.OSDeploy.deploy_descriptionLimit"></el-input>
                                <span class="desLength"> <span>{{upgradeForm.Description.length}}</span>/256</span>
                            </el-form-item>
                            <el-row>
                                <h2>{{i18ns.upgradePackageWarehouse.versionWarehouse_versionMessage}}</h2>
                            </el-row>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_versionType" class="productType">
                                <el-radio-group v-model="upgradeForm.selectMethod" @change="switchType">
                                    <el-radio-button :label="'Baseline'">{{i18ns.upgradePlan.upgradePlan_baseline}}
                                    </el-radio-button>
                                    <el-radio-button :label="'UpgradePackage'">
                                        {{i18ns.upgradePlan.upgradePlan_upgradePackage}}</el-radio-button>
                                </el-radio-group>
                                <span v-if="upgradeForm.selectMethod=='Baseline'" class="checkText"
                                    style="margin-left:10px;">{{i18ns.upgradePlan.upgradePlan_baselineTip}}</span>
                                <span v-if="upgradeForm.selectMethod=='UpgradePackage'" class="checkText"
                                    style="margin-left:10px;">{{i18ns.upgradePlan.upgradePlan_upgradePackageTip}}</span>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_selectBaseline"
                                v-if="upgradeForm.selectMethod=='Baseline'" class="productType">
                                <span class="checkText">
                                    <i class="el-icon-info"></i>{{i18ns.upgradePlan.upgradePlan_selectBaselineCreate}}
                                    <i class="descTo"
                                        @click="toCreatBaseline">{{i18ns.upgradePlan.upgradePlan_clickHere}}</i>
                                    {{i18ns.upgradePlan.upgradePlan_customBaselineWord}}
                                </span>
                                <p style="float:right;margin: 0;">
                                    <el-button size="medium" @click="deleteAll" :disabled="uplistData.length<=0">
                                        {{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                                    <el-button size="medium" @click="checkBaseline">{{i18ns.common.add}}</el-button>
                                </p>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_selectUpgradePackage"
                                v-if="upgradeForm.selectMethod=='UpgradePackage'" class="productType">
                                <span class="checkText">
                                    <i class="el-icon-info"></i>{{i18ns.upgradePlan.upgradePlan_needUpgradePackage}}
                                    <i class="descTo"
                                        @click="toUpPackage">{{i18ns.upgradePlan.upgradePlan_clickHere}}</i>
                                    {{i18ns.upgradePlan.upgradePlan_uploadUpgradePackageWord}}
                                </span>
                                <p style="float:right;margin: 0;">
                                    <el-button size="medium" @click="deleteAll" :disabled="uplistData.length<=0">
                                        {{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                                    <el-button size="medium" @click="addUpgradePackage">{{i18ns.common.add}}</el-button>
                                </p>
                            </el-form-item>
                            <el-form-item :label="i18ns.upgradePlan.upgradePlan_upgradeVersionInformation">

                            </el-form-item>
                            <el-row>
                                <template>
                                    <el-table v-bind:data="uplistData" style="width:100%;" key="uplistData" :empty-text="emptyText"
                                        header-row-class-name="my_table_header">
                                        <el-table-column prop="PackageName" :label="i18ns.upgradePlan.upgradePlan_name">
                                        </el-table-column>
                                        <el-table-column prop="SupportModel"
                                            :label="i18ns.upgradePlan.upgradePlan_productDeviceType"></el-table-column>
                                        <el-table-column prop="Versions" :label="i18ns.upgradePlan.upgradePlan_version">
                                            <template slot-scope="scope">
                                                <p v-for="(item,i) in scope.row.Version" :key="i">
                                                    <el-checkbox v-model="item.Selected" v-if="scope.row.Version.length>1"
                                                            @change="checkVersion(item)"></el-checkbox>
                                                        <span>{{item.Module}}:{{item.CurrentVer}}</span>
                                                </p>
                                            </template>
                                        </el-table-column>
                                        <el-table-column prop="Size"
                                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                                            <template slot-scope="scope">
                                                {{unitFun(scope.row.Size)}}
                                            </template>
                                        </el-table-column>
                                        <el-table-column :label="i18ns.common.operation">
                                            <template slot-scope="scope">
                                                <el-button type="text" size="small"
                                                    @click="deleteOne(scope.row,scope.$index)">{{i18ns.common.delete}}
                                                </el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                    <p style="text-align:right;" v-if="uplistData.length>0">
                                        {{i18ns.common.common_totalNumber}}{{uplistData.length}}</p>
                                </template>
                            </el-row>
                        </div>
                    </el-form>

                </el-row>
                <!-- 选择设备 -->
                <el-row>
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_selectDevice}}</h2>
                    </el-row>
                    <!-- 组选择 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_groupSelectTip}}</span>
                        <el-button :disabled="deviceData.length===0" v-on:click="clearGroup()">
                            {{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                        <el-button type="primary" @click="add()" :disabled="uplistData.length<=0"
                            v-loading.fullscreen.lock="fullscreenLoading " :element-loading-text="i18ns.common.loading">
                            {{i18ns.common.add}}</el-button>
                        <span style="color:#999;margin-left:10px;">{{i18ns.upgradePlan.upgradePlan_addGroupTips}}</span>
                    </div>
                    <el-table class="mt20" v-bind:data="deviceData" style="width:100%;" :empty-text="emptyText"
                        key="deviceData" :element-loading-text="i18ns.common.loading"
                        header-row-class-name="my_table_header">
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                <el-button type="text" @click="showGroupDetil(scope.row.Name)">{{scope.row.Name}}
                                </el-button>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Description" :label="i18ns.upgradePlan.upgradePlan_groupDescription">
                            <template slot-scope="scope">
                                <span v-if="scope.row.Description!=''">{{scope.row.Description}}</span>
                                <span v-else>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column :label="i18ns.common.operation">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" v-on:click="handleDelete(scope.row, scope.$index)">
                                    {{i18ns.common.delete}}</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="deviceData.length>0">
                        {{i18ns.common.common_totalNumber}}{{deviceData.length}}</p>
                    <!-- 设备选择 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_deviceSelectTitle}}</span>
                        <el-button :disabled="serviceData.length===0" v-on:click="clearService()">
                            {{i18ns.upgradePlan.upgradePlan_deleteAll}}</el-button>
                        <el-button type="primary" :disabled="uplistData.length<=0" @click="addService()"
                            v-loading.fullscreen.lock="fullscreenLoading " :element-loading-text="i18ns.common.loading">
                            {{i18ns.common.add}}</el-button>
                    </div>
                    <el-table class="mt20" v-bind:data="serviceData" style="width:100%;" :empty-text="emptyText"
                        key="serviceData" :element-loading-text="i18ns.common.loading"
                        header-row-class-name="my_table_header">
                        <el-table-column prop="BMCIP" :label="i18ns.upgradePlan.upgradePlan_BMCEMIP">
                            <template slot-scope="scope">
                                <el-button type="text" @click="detailsDeviceInfo(scope.row)">{{scope.row.BMCIP||scope.row.HostName}}
                                </el-button>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                {{scope.row.Name?scope.row.Name:'--'}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber">
                        </el-table-column>
                        <el-table-column prop="ProductType" :label="i18ns.upgradePlan.upgradePlan_productType">
                        </el-table-column>
                        <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{getGroupTxt(scope.row.Groups)}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel">
                        </el-table-column>
                        <el-table-column :label="i18ns.common.operation">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" v-on:click="handleDeleteS(scope.row, scope.$index)">
                                    {{i18ns.common.delete}}</el-button>
                                <el-button type="text" size="small" v-on:click="handleAccurate(scope.row, scope.$index)" v-if="scope.row.ProductType=='E9000'">
                                    {{i18ns.upgradePlan.upgradePlan_accurateUpgrade}}</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="serviceData.length>0">
                        {{i18ns.common.common_totalNumber}}{{serviceData.length}}</p>
                    <!-- 分批升级 -->
                    <div>
                        <span class="serviceTit"><i></i>{{i18ns.upgradePlan.upgradePlan_importUpgrade}}</span>
                        <el-popover placement="top-start" trigger="hover"
                            :content="i18ns.upgradePlan.upgradePlan_noneDevice"
                            v-if="batchDevice.length<=1&&batchDevice[0].list.length<=0">
                            <el-switch slot="reference" v-model="upgradeSwitch" @change="toggleSwitch()"
                                :disabled="batchDevice.length<=1&&batchDevice[0].list.length<=0"></el-switch>
                        </el-popover>
                        <el-switch v-else v-model="upgradeSwitch" @change="toggleSwitch()"
                            :disabled="batchDevice.length<=1&&batchDevice[0].list.length<=0"></el-switch>
                        <span v-if="upgradeSwitch"
                            style="color:#999">{{i18ns.upgradePlan.upgradePlan_importUpgradenYesTip}}</span>
                        <span v-else style="color:#999">{{i18ns.upgradePlan.upgradePlan_importUpgradenNoTip}}</span>
                    </div>
                    <!-- 分批升级的设备 -->
                    <div class="upgradePlan_importAddDevice" v-if="upgradeSwitch">
                        <partial :batch-device="batchDevice" @adddevice="showBatch"></partial>
                    </div>
                </el-row>
                <!-- 升级策略 -->
                <el-row>
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_upgradePolicy}}</h2>
                    </el-row>
                    <el-form v-bind:model="planForm" ref="planForm" v-bind:label-width="labelWidth"
                        label-position="left" label-suffix=":">
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_executionPolicy" class="productType">
                            <p>
                                <el-popover placement="top-start" trigger="hover"
                                    :content="i18ns.upgradePlan.upgradePlan_notPeriodTip"
                                    v-if="serviceData.length <= 0&&groupDevices.length<=0">
                                    <el-radio slot="reference" v-model="ExecutionPolicy" :label="'Immediate'"
                                        :disabled="serviceData.length <= 0&&groupDevices.length<=0">
                                        {{i18ns.upgradePlan.upgradePlan_immediateExecution}}</el-radio>
                                </el-popover>
                                <el-radio v-else v-model="ExecutionPolicy" :label="'Immediate'"
                                    :disabled="serviceData.length <= 0&&groupDevices.length<=0">
                                    {{i18ns.upgradePlan.upgradePlan_immediateExecution}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_immediateExecutionTip}}</span>
                            </p>
                            <p>
                                <el-popover placement="top-start" trigger="hover"
                                    :content="i18ns.upgradePlan.upgradePlan_periodTip" v-if="upgradeSwitch">
                                    <el-radio slot="reference" v-model="ExecutionPolicy" :label="'Period'"
                                        :disabled="upgradeSwitch">{{i18ns.upgradePlan.upgradePlan_cycleCheck}}
                                    </el-radio>
                                </el-popover>
                                <el-radio v-else v-model="ExecutionPolicy" :label="'Period'" :disabled="upgradeSwitch">
                                    {{i18ns.upgradePlan.upgradePlan_cycleCheck}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_cycleCheckTip}}</span>
                            </p>
                            <p>
                                <el-popover placement="top-start" trigger="hover"
                                    :content="i18ns.upgradePlan.upgradePlan_notPeriodTip"
                                    v-if="serviceData.length <= 0&&groupDevices.length<=0">
                                    <el-radio slot="reference" v-model="ExecutionPolicy" :label="'SpecifiedTime'"
                                        :disabled="serviceData.length <= 0&&groupDevices.length<=0">
                                        {{i18ns.upgradePlan.upgradePlan_specifiedTime}}</el-radio>
                                </el-popover>
                                <el-radio v-else v-model="ExecutionPolicy" :label="'SpecifiedTime'"
                                    :disabled="serviceData.length <= 0&&groupDevices.length<=0">
                                    {{i18ns.upgradePlan.upgradePlan_specifiedTime}}</el-radio>
                                <span v-show="ExecutionPolicy=='SpecifiedTime'">
                                    <el-date-picker v-model="SpecifiedTime" type="datetime" :editable='false'>
                                    </el-date-picker>
                                </span>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_specifiedTimeTip}}</span>
                            </p>
                        </el-form-item>
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_effectPolicy" class="productType">
                            <p>
                                <el-radio v-model="EffectPolicy" :label="false">
                                    {{i18ns.upgradePlan.upgradePlan_effectiveLater}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_effectiveLaterTip}}</span>
                            </p>
                            <p>
                                <el-radio v-model="EffectPolicy" :label="true">
                                    {{i18ns.upgradePlan.upgradePlan_immediateEffect}}</el-radio>
                                <span class="radioDesc">{{i18ns.upgradePlan.upgradePlan_immediateEffectTip}}</span>
                            </p>
                        </el-form-item>
                    </el-form>
                </el-row>

                <!-- 导入基线 -->
                <el-dialog :close-on-click-modal="false"
                    :title="i18ns.upgradePackageWarehouse.versionWarehouse_importExitBaseline"
                    :visible.sync="Baselineisible" width="80%">
                    <el-table v-bind:data="baseLinelistData" border style="width:100%;" :empty-text="emptyText"
                        :element-loading-text="i18ns.common.loading" header-row-class-name="my_table_header"
                        @current-change="handleradioChange">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-table :data="props.row.FirmwarePackages" style="width: 100%;"
                                    header-row-class-name="my_table_header">
                                    <el-table-column prop="PackageName"
                                        :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                                        :show-overflow-tooltip="true"></el-table-column>
                                    <el-table-column prop="SupportModel"
                                        :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType">
                                    </el-table-column>
                                    <el-table-column prop="Version"
                                        :label="i18ns.upgradePackageWarehouse.versionWarehouse_version">
                                        <template slot-scope="scope">
                                            <p v-for="vis in scope.row.Version">
                                                <span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="Size"
                                        :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                                        <template slot-scope="scope">
                                            {{unitFun(scope.row.Size)}}
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </template>
                        </el-table-column>
                        <el-table-column label="" width="70" center>
                            <template slot-scope="scope">
                                <el-radio class="radio" v-model="baselineRadio" :label="scope.row.UUID">&nbsp;
                                </el-radio>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Name"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_baselineName"></el-table-column>
                        <el-table-column prop="Status" :label="i18ns.upgradePackageWarehouse.versionWarehouse_usedState"
                            sortable>
                            <template slot-scope="scope">
                                <span
                                    v-if="scope.row.Status=='Unused'">{{i18ns.upgradePackageWarehouse.versionWarehouse_notUsed}}</span>
                                <span
                                    v-else-if="scope.row.Status=='Using'">{{i18ns.upgradePackageWarehouse.versionWarehouse_using}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Version" :label="i18ns.upgradePackageWarehouse.versionWarehouse_version">
                        </el-table-column>
                    </el-table>
                    <el-row class="pagination-row">
                        <el-col v-bind:span="24" style="text-align:left;">
                            <el-pagination @size-change="pageInfo2HandleSizeChange"
                                @current-change="pageInfo2HandleCurrentChange"
                                v-bind:current-page="pageInfo2.currentPage" v-bind:page-sizes="pageInfo2.pageSizes"
                                v-bind:page-size="pageInfo2.pageSize"
                                layout="total, sizes, prev, pager, next, jumper,slot" v-bind:total="pageInfo2.total">
                                <el-button style="border: 1px solid #c4c4c4;margin-left: 10px;">{{i18ns.common.confirm}}
                                </el-button>
                            </el-pagination>
                        </el-col>
                    </el-row>
                    <div slot="footer" class="dialog-footer">
                        <el-row>
                            <el-col :span="12" style="text-align:left;">
                                <span>{{i18ns.upgradePackageWarehouse.versionWarehouse_alreadyBaseline}}：{{checkedBaseLine1.Name}}</span>
                            </el-col>
                            <el-col :span="12">
                                <el-button @click="cancleBaseline">{{i18ns.common.cancel}}</el-button>
                                <el-button @click="inportSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                                    :element-loading-text="i18ns.common.loading" :disabled="checkdBaseline.length<=0"
                                    type="primary">{{i18ns.common.confirm}}</el-button>
                            </el-col>
                        </el-row>

                    </div>
                </el-dialog>
                <!-- 添加升级包 -->
                <el-dialog :close-on-click-modal="false"
                    :title="i18ns.upgradePackageWarehouse.versionWarehouse_addUpgradePackage"
                    :visible.sync="UpgradePackageisible" width="80%">
                    <el-row class="packageSearch">
                        <el-col :span="16">
                            <span>{{i18ns.upgradePackageWarehouse.versionWarehouse_firmwareType}}：</span>
                            <el-select v-model="FirmwareType" :placeholder="i18ns.common.pleaseSelect" multiple
                                @change="FirmwareTypeChange" class="el-select-multiple">
                                <el-option v-for="(item,i) in FirmwareTypeOptions" :key="i" :label="item.Module"
                                    :value="item.Module">
                                </el-option>
                            </el-select>
                        </el-col>
                        <el-col :span="8" class="input-with-select">
                            <el-input :placeholder="i18ns.OSDeploy.deploy_pleaseInputKeywords" disabled clearable>
                                <el-select v-model="packageValue" slot="prepend" disabled>
                                    <el-option :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                                        value="1"></el-option>
                                </el-select>
                                <el-button slot="append" icon="el-icon-search" disabled></el-button>
                            </el-input>
                        </el-col>
                    </el-row>
                    <el-table ref="addpackage" :data="UpgradePackage" border style="width: 100%;"
                        header-row-class-name="add_table_header"  :empty-text="emptyText"
                        @selection-change="packageSelectionChange" row-key="UUID">
                        <el-table-column type="selection" width="55" :selectable='checkboxT' :reserve-selection="true">
                        </el-table-column>
                        <el-table-column prop="PackageName"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_upgradeName"
                            :show-overflow-tooltip="true"></el-table-column>
                        <el-table-column prop="Type" :label="i18ns.upgradePackageWarehouse.versionWarehouse_type">
                            <template slot-scope="scope">
                                <span
                                    v-if="scope.row.Type=='Package_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageFirmware}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Package_Software'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageSoftware}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Bundle_Driver'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageDirve}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Bundle_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_bundleFirmware}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Bundle_Software'">{{i18ns.upgradePackageWarehouse.versionWarehouse_bundleSoftware}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Board_Firmware'">{{i18ns.upgradePackageWarehouse.versionWarehouse_boardPackage}}</span>
                                <span
                                    v-else-if="scope.row.Type=='Package_Driver'">{{i18ns.upgradePackageWarehouse.versionWarehouse_packageDirve}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="SupportModel"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType"></el-table-column>
                        <el-table-column prop="Version" :label="i18ns.upgradePackageWarehouse.versionWarehouse_version">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.Version"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Size" :label="i18ns.upgradePackageWarehouse.versionWarehouse_size">
                            <template slot-scope="scope">
                                {{unitFun(scope.row.Size)}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="CreationTime"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_time" sortable></el-table-column>
                    </el-table>
                    <el-row class="pagination-row">
                        <el-col v-bind:span="24" style="text-align:left;">
                            <el-pagination @size-change="pageInfo1HandleSizeChange"
                                @current-change="pageInfo1HandleCurrentChange"
                                v-bind:current-page="pageInfo1.currentPage" v-bind:page-sizes="pageInfo1.pageSizes"
                                v-bind:page-size="pageInfo1.pageSize"
                                layout="total, sizes, prev, pager, next, jumper,slot" v-bind:total="pageInfo1.total">
                                <el-button style="border: 1px solid #c4c4c4;margin-left: 10px;">{{i18ns.common.confirm}}
                                </el-button>
                            </el-pagination>
                        </el-col>
                    </el-row>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="UpgradePackageisible=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="packageSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.confirm}}
                        </el-button>
                    </div>
                </el-dialog>
                <!-- 添加时替换升级包 -->
                <el-dialog :close-on-click-modal="false" :title="i18ns.common.prompt"
                    :visible.sync="addPackageDialogisible" width="60%">
                    <el-row>
                        <el-alert :title="i18ns.upgradePackageWarehouse.versionWarehouse_baselinePackageRepeat"
                            type="info"
                            :description="i18ns.upgradePackageWarehouse.versionWarehouse_baselinePackageRepeatTip"
                            show-icon :closable="false">
                        </el-alert>
                    </el-row>
                    <el-table ref="addReplacePackage" :data="messageData" border style="width: 100%; margin-top: 10px;"
                        header-row-class-name="my_table_header" @selection-change="addPackageReplaceChange">
                        <el-table-column type="selection" width="55"> </el-table-column>
                        <el-table-column prop="SupportModel"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_productType"></el-table-column>
                        <el-table-column prop="hasVersion"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_existingVersion">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.hasVersion"><span>{{vis.Module}}：</span>{{vis.CurrentVer}}
                                </p>
                            </template>
                        </el-table-column>
                        <el-table-column prop="replaceVersion"
                            :label="i18ns.upgradePackageWarehouse.versionWarehouse_replaceVersion">
                            <template slot-scope="scope">
                                <p v-for="vis in scope.row.replaceVersion">
                                    <span>{{vis.Module}}：</span>{{vis.CurrentVer}}</p>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="addPackageDialogisible=false">{{i18ns.common.no}}</el-button>
                        <el-button @click="addReplacePackageSubmit" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.yes}}</el-button>
                    </div>
                </el-dialog>
                <!-- 添加 组的弹窗 -->
                <el-dialog :close-on-click-modal="false" :title="i18ns.upgradePlan.upgradePlan_groupAdd"
                    :visible.sync="deviceDialog" width="80%">
                    <el-table ref="nodeTable" :data="deviceList" border style="width: 100%; margin-top: 10px;" :empty-text="emptyText"
                        key="deviceList" @selection-change="handleSelectDevice">
                        <el-table-column type="selection" width="55" :selectable='checkboxGroupT'></el-table-column>
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name"></el-table-column>
                        <el-table-column prop="Description" :label="i18ns.upgradePlan.upgradePlan_descriptionTip">
                            <template slot-scope="scope">
                                <span v-if="scope.row.Description!=''">{{scope.row.Description}}</span>
                                <span v-else>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column :label="i18ns.upgradePlan.upgradePlan_useStatus">
                            <template slot-scope="scope">
                                <span>{{scope.row.EnableLabel}}</span>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="deviceList.length>0">
                        {{i18ns.common.common_totalNumber}}{{deviceList.length}}</p>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="deviceDialog=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensureDevice" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary">{{i18ns.common.confirm}}
                        </el-button>
                    </div>
                </el-dialog>
                <!--添加设备的弹窗 -->
                <el-dialog :close-on-click-modal="false" :title="i18ns.upgradePlan.upgradePlan_addDevicces"
                    :visible.sync="serviceDialog" width="80%">
                    <el-row v-if="MINSPVersion&&MINSPVersion!=''">
                        <p><i class="el-icon-info" style="color:#409eff;font-style:normal;"></i>{{MINSPVersionTip}}</p>
                    </el-row>
                    <el-row class="packageSearch">
                        <el-col :span="16">
                            <span>{{i18ns.upgradePlan.upgradePlan_group}}：</span>
                            <el-select v-model="groupDev" :placeholder="i18ns.common.pleaseSelect" multiple
                                @change="changeGroupOwern" class="el-select-multipleauto">
                                <el-option v-for="(item,i) in groupOptions" :key="i" :label="item.label"
                                    :value="item.id"></el-option>
                            </el-select>
                        </el-col>
                        <el-col :span="8" class="input-with-select">
                            <span>{{i18ns.upgradePlan.upgradePlan_productType}}：</span>
                            <el-select v-model="productValueValue" :placeholder="i18ns.common.pleaseSelect"
                                @change="changeType">
                                <el-option v-for="(item,i) in productTypes" :key="i" :label="item.label"
                                    :value="item.id"></el-option>
                            </el-select>
                        </el-col>
                    </el-row>
                    <el-table ref="serviceList" :data="serviceList" border style="width: 100%; margin-top: 10px;" :empty-text="emptyText"
                        key="serviceList" :header-row-class-name="serviceList.length>0?'':'device_table_header'"
                        @select-all="handleSelectS" @select="selectItem">
                        <el-table-column type="selection" width="55" :selectable='checkboxDeviceT'></el-table-column>
                        <el-table-column prop="Name" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                {{scope.row.Name?scope.row.Name:'--'}}
                            </template>
                        </el-table-column>
                        <el-table-column prop="BMCIP" :label="i18ns.upgradePlan.upgradePlan_BMCEMIP"></el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber">
                        </el-table-column>
                        <el-table-column prop="ProductType" :label="i18ns.upgradePlan.upgradePlan_productType">
                        </el-table-column>
                        <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{getGroupTxt(scope.row.Groups)}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel">
                            <template slot-scope="scope">
                                <span>{{scope.row.AssetTag?scope.row.AssetTag:'--'}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="SPVersion" :label="i18ns.upgradePlan.upgradePlan_SPVersion">
                            <template slot-scope="scope">
                                <span>{{getSpTxt(scope.row.SPVersion)?getSpTxt(scope.row.SPVersion):"--"}}</span>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="serviceList.length>0">
                        {{i18ns.common.common_totalNumber}}{{serviceList.length}}</p>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="serviceDialog=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensureService" v-loading.fullscreen.lock="fullscreenLoading"
                            :disabled="deviceChecked.length<=0" :element-loading-text="i18ns.common.loading"
                            type="primary">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!-- 设备组的单个详情 -->
                <el-dialog :close-on-click-modal="false" :title="groupItemTit" :visible.sync="groupDialog" width="80%">
                    <el-row>
                        <p><i class="el-icon-info"
                                style="color:#409eff;font-style:normal;"></i>{{i18ns.upgradePlan.upgradePlan_filterDevice}}
                        </p>
                    </el-row>
                    <el-table :data="groupItem" border style="width: 100%; margin-top: 10px;" :empty-text="emptyText"
                        header-row-class-name="my_table_header">
                        <el-table-column prop="IPv4Address.Address" :label="i18ns.upgradePlan.upgradePlan_BMCIP">
                            <template slot-scope="scope">
                                <el-button type="text" @click="detailsInfo(scope.row)">{{scope.row.IPv4Address.Address}}
                                </el-button>
                            </template>
                        </el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber">
                        </el-table-column>
                        <el-table-column prop="Model" :label="i18ns.upgradePlan.upgradePlan_productType">
                        </el-table-column>
                        <el-table-column prop="Group" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{getGroupTxt(scope.row.Group)}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="Tag" :label="i18ns.upgradePlan.upgradePlan_label"></el-table-column>
                    </el-table>
                </el-dialog>
                <!-- 设备的详情 -->
                <device-info :device-info="deviceInfo" :device-item-tit="deviceItemTit" ref="deviceInfoDialog">
                </device-info>
                <!-- 分批添加 -->
                <el-dialog :close-on-click-modal="false" :title="i18ns.upgradePlan.upgradePlan_addBatches"
                    :visible.sync="batchDeviceDialog" width="80%">
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_information}}</h2>
                    </el-row>
                    <el-form v-bind:model="batchForm" v-bind:rules="batchRules" ref="batchForm"
                        v-bind:label-width="labelWidth" label-position="left" label-suffix=":">
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_teamName" class="productType">
                            <span>{{batchForm.teamName}}</span>
                        </el-form-item>
                        <el-form-item :label="i18ns.upgradePlan.upgradePlan_delayTime">
                            <inputnum ref="inputnum" :num="batchForm.num" @changenum="setnum"></inputnum>
                        </el-form-item>
                    </el-form>
                    <el-row>
                        <h2>{{i18ns.upgradePlan.upgradePlan_deviceSelectTwo}}</h2>
                    </el-row>
                    <el-table ref="otherList" :data="otherList" border style="width: 100%; margin-top: 10px;"
                        key="otherList" :header-row-class-name="otherList.length>0?'':'device_table_header'"
                        @selection-change="handleSelectBatch">
                        <el-table-column type="selection" width="55"></el-table-column>
                        <el-table-column prop="" :label="i18ns.upgradePlan.upgradePlan_name">
                            <template slot-scope="scope">
                                <span>--</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="BMCIP" :label="i18ns.upgradePlan.upgradePlan_BMCEMIP"></el-table-column>
                        <el-table-column prop="SerialNumber" :label="i18ns.upgradePlan.upgradePlan_serialNumber">
                        </el-table-column>
                        <el-table-column prop="ProductType" :label="i18ns.upgradePlan.upgradePlan_productType">
                        </el-table-column>
                        <el-table-column prop="Groups" :label="i18ns.upgradePlan.upgradePlan_group">
                            <template slot-scope="scope">
                                <span>{{getGroupTxt(scope.row.Groups)}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column prop="AssetTag" :label="i18ns.upgradePlan.upgradePlan_assetLabel">
                            <template slot-scope="scope">
                                <span>{{scope.row.AssetTag?scope.row.AssetTag:'--'}}</span>
                            </template>
                        </el-table-column>
                    </el-table>
                    <p style="text-align:right;padding:0 20px;" v-if="otherList.length>0">
                        {{i18ns.common.common_totalNumber}}{{otherList.length}}</p>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="batchDeviceDialog=false">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensureaddBatches" v-loading.fullscreen.lock="fullscreenLoading"
                            :element-loading-text="i18ns.common.loading" type="primary"
                            :disabled="checkBatchDevice.length<=0">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!-- 精准升级 -->
                <el-dialog :close-on-click-modal="false" :title="deviceName" :visible.sync="preciseDialog" v-if="preciseDialog" width="80%">
                    <el-row>
                        <p>
                            <i class="el-icon-info" style="color:#409eff;font-style:normal;"></i>
                            {{i18ns.upgradePlan.upgradePlan_chassisStatusDetailPopTip}}
                        </p>
                    </el-row>
                    <el-tabs v-model="activeName" type="card" @tab-click="handleClick">
                        <el-tab-pane :label="i18ns.common.server" name="Server">
                                <server-table ref="serverData" :f-d-ip="FDIp" :server-data="serverData" @taskselectionchange="taskSelectionChange"></server-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_management" name="Manager">
                            <p><i class="el-icon-info" style="color:#409eff;font-style:normal;"></i>{{i18ns.upgradePlan.upgradePlan_managerTip}}</p>
                            <manager-table ref="managerData" :f-d-ip="FDIp" :manager-data="managerData" @taskselectionchange="taskSelectionChange"></manager-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_switch" name="Switch">
                            <switch-table ref="switchData" :f-d-ip="FDIp" :switch-data="switchData" @taskselectionchange="taskSelectionChange"></switch-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_fanOrOther" name="Fan">
                            <fan-table ref="fanData" :f-d-ip="FDIp" :fan-data="fanData" @taskselectionchange="taskSelectionChange"></fan-table>
                        </el-tab-pane>
                    </el-tabs>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="canclepreciseDialog">{{i18ns.common.cancel}}</el-button>
                        <el-button @click="ensurePrecise" type="primary">{{i18ns.common.confirm}}</el-button>
                    </div>
                </el-dialog>
                <!-- 精准升级设备的详情 -->
                <el-dialog :close-on-click-modal="false" :title="deviceTit" custom-class="detailDevice" :visible.sync="preciseDetailDialog" width="80%">
                    <el-tabs v-model="activeDetail" type="card" @tab-click="handleDetailClick">
                        <el-tab-pane :label="i18ns.common.server" name="Server">
                            <server-table ref="serverData" :f-d-ip="FDIp" :is-check="isCheckDetail" :server-data="serverData"></server-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_management" name="Manager">
                            <manager-table ref="managerData" :f-d-ip="FDIp" :is-check="isCheckDetail" :manager-data="managerData"></manager-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_switch" name="Switch">
                            <switch-table ref="switchData" :f-d-ip="FDIp" :is-check="isCheckDetail" :switch-data="switchData"></switch-table>
                        </el-tab-pane>
                        <el-tab-pane :label="i18ns.deviceVersionStatus.deviceVersionStatus_fanOrOther" name="Fan">
                            <fan-table ref="fanData" :f-d-ip="FDIp" :is-check="isCheckDetail" :fan-data="fanData"></fan-table>
                        </el-tab-pane>
                    </el-tabs>
                </el-dialog>
            </div>
        </el-row>
        <el-row>
            <!-- 底部按钮 -->
            <el-button style="margin-top:10px;" @click="back">{{i18ns.common.cancel}}</el-button>
            <el-button style="margin-top:10px;" @click="submitPlan"
                :disabled="uplistData.length<=0||(serviceData.length <= 0&&deviceData.length<=0)||subDisabled">
                {{i18ns.common.submit}}</el-button>
        </el-row>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                editLoading: true,
                labelWidth: '250px',
                i18ns: [],
                FDIp: '',
                FDList: [],
                loading: false,
                fullscreenLoading: false,
                oldPlanName:'',
                upgradeForm: {
                    PlanName: '',
                    Description: '',
                    selectMethod: 'Baseline',
                },
                rules: {
                    PlanName: {
                        required: true,
                        validator: function (rule, value, callback) {
                            if (value) {
                                if (!/^[a-zA-Z0-9_\-.\u4e00-\u9fa5]+$/.test(value) || value.length >
                                    32) {
                                    return callback(new Error(app.i18ns.common.regExp_userName));
                                } else
                                    return callback();
                            } else {
                                return callback(new Error(app.i18ns.upgradePackageWarehouse
                                    .configInfo_inputNotNull));
                            }
                        },
                        trigger: 'blur'
                    },
                    Description: {
                        required: false,
                        validator: function (rule, value, callback) {
                            if (value) {
                                if (value.length > 256) {
                                    return callback(new Error(app.i18ns.OSDeploy.deploy_descriptionLimit));
                                } else
                                    return callback();
                            } else {
                                return callback();
                            }
                        },
                        trigger: 'change'
                    },
                },
                //选择版本
                isPlanName: false, //名称是否重复
                uplistData: [],
                pageInfo1: {
                    currentPage: 1,
                    pageSizes: [10, 20, 50, 100],
                    pageSize: 10,
                    total: 0,
                },
                pageInfo2: {
                    currentPage: 1,
                    pageSizes: [10, 20, 50, 100],
                    pageSize: 10,
                    total: 0,
                },
                baseLinelistData: [],
                allBaseLinelist: [], //存放从接口返回的全部基线（不分页查询）
                Baselineisible: false,
                baselineRadio: '',
                baselineData:[],
                checkdBaseline: [], //选择的基线
                checkedBaseLine1: [],
                packageData: [], //选择的升级包
                //导入已有基线
                UpgradePackageisible: false,
                allUpgradePackageList: [], //存放从接口返回的全部升级包（不分页查询）
                UpgradePackage: [],
                checkedBaseId: '',
                firmwarePackages: '',
                //添加服务包
                ProductType: '',
                ProductTypes: [],
                FirmwareType: [],
                FirmwareTypeOptions: [],
                checkedPackage: [],
                addpackageRadio: '',
                addpackageLoading: false,
                packageValue: '1',
                oldAllPackageList: [],
                //替换
                replaceisible: false,
                oldPackage: [],
                replacePackage: [],
                packageRadio: '',
                checkedReplacePackage: '',

                // 添加升级包时的替换
                messageCheckedList: '',
                messageChecked: [],
                messageData: [],
                addPackageDialogisible: false,
                hasData: '',
                replaceType: 'baseline',
                // 设备信息
                //组选择
                deviceData: [],
                deviceDialog: false,
                isCheckAll: true, //是否选中所有设备行
                deviceList: [],
                checkedDevice: [],
                checkedDeviceNum: 0,
                isBackFlag: false, //隐藏高版本
                deviceNum: 0,
                isCheckGroup: [],
                groupDevices: [],
                EnableLabel: '',
                //设备选择
                serviceData: [],
                serviceDialog: false,
                serviceList: [],
                checkedService: [],
                serviceNum: 0,
                checkedServiceNum: 0,
                productTypes: [],
                productValueValue: '',
                groupOptions: [],
                groupDev: [],
                MINSPVersion: '',
                MINSPVersionTip: '',
                productData: [], //产品类型
                deviceProductTypes: [], //选择的产品类型
                deviceChecked: [], //筛选前选中的设备
                //分批升级
                upgradeSwitch: false,

                // 升级策略
                planForm: {},
                ExecutionPolicy: 'Immediate',
                EffectPolicy: false,
                SpecifiedTime: '', //

                ID: '',
                oldTime: '',
                // 设备组的详情
                groupDialog: false,
                groupItemTit: '',
                groupItem: [],
                isCheckgroup: false,

                oldDeviceGroupData: [],
                batchDevice: [{
                    list: []
                }],
                timeDelay: 0,
                batchDeviceDialog: false,
                batchForm: {
                    num: 1
                },
                batchRules: {},
                otherList: [],
                checkBatchDevice: [],
                //设备的详情
                deviceInfo: [],
                deviceItemTit: '',

                subDisabled: false,
                emptyText: '',

                //精准升级
                frameSrcData:[],
                preciseId:'',
                deviceName:'',
                preciseDialog:false,
                activeName:'Server',
                serverData:[],
                checkServer:[],
                managerData:[],
                checkManager:[],
                switchData:[],
                checkSwitch:[],
                fanData:[],
                checkFan:[],
                checkedAccurate:[],
                // 精准升级的详情
                preciseDetailDialog:false,
                deviceTit:'',
                activeDetail:'Server',
                isCheckDetail:false,

                numberTime:2,
                serData:[],
                ensData:[],
                isGet:[],
                isclick:true
            },
            computed: {
                updalodUrl: function () {
                    return com_huawei_fdvcenterpluginui.webContextPath + '/rest/services/fd/upload?ips=' +
                        this.FDIp +
                        '&httpMethod=POST&endpoint=/rich/UpgradeService/Actions/Package.Import';
                }
            },
            watch: {
                batchDevice: {
                    handler: function (val, oldVal) {
                        if (val.length <= 1 && val[0].list.length <= 0) {
                            app.upgradeSwitch = false;
                            app.ExecutionPolicy = "Period";
                        }
                    },
                    deep: true
                },
            },
            created: function () {
                this.i18ns = getIn18();
                this.emptyText = this.i18ns.common.loading;
                this.ID = getQueryString('id');
                this.editLoading = true;
            },
            mounted: function () {
                var that = this;
                //获取FD列表数据
                setTimeout(function () {
                    getFDList(that.bindFD);
                }, 0);
            },
            methods: {
                unitFun: function (Size) {
                    return unitFun(Size)
                },
                /**
                 * 获取FD数据 回调函数
                 * @param {any} ret 
                 */
                bindFD: function (ret) {
                    if (ret.code === '0') {
                        var lg = ret.data.length;
                        if (lg > 0) {
                            var data = ret.data;
                            for (var i = 0; i < data.length; i++) {
                                this.FDList.push({
                                    label: data[i].aliasName || data[i].hostIp,
                                    value: data[i].hostIp
                                });
                            }
                            var currentFD = getCurrentFD();
                            if (currentFD) {
                                var _currentFD = _.find(this.FDList, {
                                    value: currentFD
                                })
                                if (_currentFD) {
                                    this.FDIp = currentFD;
                                } else {
                                    setCurrentFD(ret.data[0].hostIp);
                                    this.FDIp = ret.data[0].hostIp;
                                }
                            } else {
                                setCurrentFD(ret.data[0].hostIp);
                                this.FDIp = ret.data[0].hostIp;
                            }
                        } else {
                            alertMsg(getErrorMsg({
                                code: '-90002'
                            }))
                        }
                        this.getGroupList()
                    } else {
                        if (ret.ip != app.FDIp) {
                            return false
                        }
                        var msg = getErrorMsg(ret);
                        alertMsg(msg);
                    }
                },
                /**
                 * FD下拉框 点击切换事件
                 * 
                 * @param {any} command 
                 * @param {any} com 
                 */
                commandClick: function () {
                    setCurrentFD(this.FDIp);
                    this.uplistData = []
                    this.checkedBaseLine1 = [];
                    this.checkdBaseline = [];
                    this.baselineData = []
                    this.serviceData = []
                },
                /**
                 * 获取单个的详情
                 */
                getItemDetail: function () {
                    this.emptyText = this.i18ns.common.loading;
                    upgradePackageManage.getUpgradePlanById({
                        ip: this.FDIp,
                        id: this.ID
                    }, function (ret) {
                        app.editLoading = false;
                        app.emptyText = app.i18ns.common.noData;
                        if (ret.code == '0') {
                            var obj = ret.data[0].data;
                            app.oldPlanName = obj.Name;
                            app.upgradeForm = {
                                PlanName: obj.Name,
                                Description: obj.Description,
                                selectMethod: obj.VersionType
                            };
                            if (obj.VersionType == 'Baseline') {
                                if (obj.BaselineInfo.FirmwarePackages) {
                                    var firmwarePackages = [];
                                    _.each(obj.BaselineInfo.FirmwarePackages, function (baselineEle) {
                                        if (_.filter(baselineEle.Version, {
                                                Selected: true
                                            }).length > 0) {
                                            firmwarePackages.push({
                                                ProductType: baselineEle.SupportModel,
                                                PackageName: baselineEle.PackageName,
                                                ReleaseNotes: baselineEle.ReleaseNotes,
                                                Size: baselineEle.Size,
                                                Source: baselineEle.Source,
                                                SupportModel: baselineEle.SupportModel,
                                                Version: baselineEle.Version
                                            })
                                        }
                                    });
                                    app.uplistData = firmwarePackages;
                                    app.checkdBaseline = firmwarePackages;
                                    app.baselineData = firmwarePackages;
                                }
                                app.checkedBaseId = obj.BaselineInfo.UUID;
                            }
                            if (obj.VersionType == 'UpgradePackage') {
                                app.uplistData = obj.Packages;
                                app.packageData = obj.Packages;
                                _.each(app.uplistData, function (item) {
                                    item.SupportModel = item.ProductType;
                                    item.UUID = item.ID;
                                })
                            }
                            _.each(obj.DeviceGroupIDs, function (item) {
                                _.each(app.deviceList, function (device) {
                                    if (item == device.ID) {
                                        app.deviceData.push(device);
                                    }
                                })
                            })
                            app.deviceData = _.union(app.deviceData);
                            app.oldDeviceGroupData = _.union(app.deviceData);
                            if (obj.TaskFlow) {
                                var batchDevice = [];
                                _.each(obj.TaskFlow, function (item) {
                                    var obj = {
                                        timeDelay: item.BatchInterval > 0 ? item.BatchInterval / 60 : 0,
                                        list: []
                                    }
                                    if (item.Devices && item.Devices.length > 0) {
                                        for (var n = 0; n < item.Devices.length; n++) {
                                            if(item.Devices[n].ProductType=='E9000'){
                                                app.frameSrcData.push(item.Devices[n])
                                            }
                                            if(_.some(app.deviceData,function(o){
                                                return item.Devices[n].Groups&&item.Devices[n].Groups.indexOf(o.Name)>-1
                                            })){
                                                app.groupDevices.push(item.Devices[n])
                                            }
                                        }
                                        app.serviceData = app.serviceData.concat(item.Devices)
                                        obj.list = obj.list.concat(item.Devices);
                                    }
                                    if (item.GroupDeviceInfos.length > 0) {
                                        app.groupDevices = app.groupDevices.concat(item.GroupDeviceInfos)
                                        obj.list = obj.list.concat(item.GroupDeviceInfos);
                                    }
                                    batchDevice.push(obj);
                                })
                                if (batchDevice.length > 1) {
                                    app.batchDevice.splice(0)
                                    app.batchDevice = batchDevice;
                                    app.upgradeSwitch = true;
                                } else {
                                    app.batchDevice = [{
                                        list: app.uniq(app.groupDevices, app.serviceData)
                                    }];
                                }
                            }
                            app.ExecutionPolicy = obj.ExecutionPolicy;
                            app.EffectPolicy = obj.ResetImmediately;
                            if (obj.ExecutionPolicy != 'SpecifiedTime') {
                                app.SpecifiedTime = new Date(sessionStorage.getItem('serverDate').replace(/-/g, "/"));
                            } else {
                                var time = obj.SpecifiedTime;
                                time = time.replace(/[T,Z]/g, " ");
                                this.oldTime = time;
                                app.SpecifiedTime = new Date(time.replace(/-/g, "/"));
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 切换版本类型
                 */
                switchType: function () {
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        this.uplistData = this.baselineData
                    } else if (this.upgradeForm.selectMethod == 'UpgradePackage') {
                        this.uplistData = this.packageData;
                    }
                    if(this.uplistData.length>0){
                        this.getGroupAndDevice()
                    }
                },
                getGroupAndDevice: function () {
                    if (this.deviceData.length > 0) {
                        if(this.uplistData.length==0){
                            app.groupDevices = []
                            this.batchDevice = [{
                                list: app.uniq(app.groupDevices, app.serviceData)
                            }];
                        }
                        this.groupDevice()
                    }
                        this.getSerList()
                },
                /**
                 * 自定义基线
                 */
                toCreatBaseline: function () {
                    window.location.href = '../upgradePackageWarehouse/createBaseline.html';
                },
                /**
                 * 上传升级包
                 */
                toUpPackage: function () {
                    window.location.href = "../upgradePackageWarehouse/index.html?type=" + 'second';
                },

                /**
                 * 添加已有基线
                 */
                checkBaseline: function () {
                    this.Baselineisible = true;
                    this.replaceType = 'baseline';
                    this.getBaselineData()
                },
                /**
                 * 取消选择基线
                 */
                cancleBaseline:function(){
                    this.Baselineisible = false;
                    this.checkdBaseline = [];
                },
                /**
                 * 获取已有基线列表
                 */
                getBaselineData: function () {
                    this.baseLinelistData = [];
                    this.pageInfo2.total = 0;
                    this.allBaseLinelist = [];
                    this.emptyText = this.i18ns.common.loading;
                    this.pageInfo2.currentPage = 1;
                    this.pageInfo2.pageSize = 10;
                    upgradePackageManage.getAllBaselineList({
                        ip: this.FDIp,
                    }, function (ret) {
                            app.emptyText = app.i18ns.common.noData;
                        if (ret.code == '0') {
                            var data = ret.data[0].data.Members;
                            for (var k = 0; k < data.length; k++) {
                                for (var i = 0; i < data[k].FirmwarePackages.length; i++) {
                                    for (var j = 0; j < data[k].FirmwarePackages[i].Version.length; j++) {
                                        data[k].FirmwarePackages[i].Version[j].Selected = true;
                                    }
                                }
                            }
                            app.allBaseLinelist = data;
                            var index = _.findIndex(app.allBaseLinelist, function (x) {
                                return x.UUID == app.baselineRadio;
                            });
                            if (index < 0) {
                                index = 0;
                            }
                            if (app.allBaseLinelist.length > 0) {
                                app.checkedBaseLine1 = app.allBaseLinelist[index];
                                app.checkdBaseline = app.allBaseLinelist[index].FirmwarePackages;
                                app.checkedBaseId = app.allBaseLinelist[index].UUID;
                            }
                            app.baselineRadio = app.checkedBaseId;
                            app.pageInfo2.total = app.allBaseLinelist.length;
                            if (app.pageInfo2.total > 0) {
                                app.baseLinelistData = app.allBaseLinelist.slice(0, app.pageInfo2
                                    .pageSize);
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 添加升级包
                 */
                addUpgradePackage: function () {
                    this.addpackageRadio = "";
                    this.FirmwareType = []
                    this.UpgradePackageisible = true;
                    Vue.nextTick(function () {
                        app.$refs.addpackage.clearSelection()
                    })
                    this.replaceType = 'package';
                    this.pageInfo1.currentPage = 1;
                    this.pageInfo1.pageSize = 10;
                    this.getPackageList()
                },
                /**
                 * 获取升级包列表
                 */
                getPackageList: function () {
                    this.UpgradePackage = [];
                    this.allUpgradePackageList = [];
                    this.emptyText = this.i18ns.common.loading;
                    upgradePackageManage.getAllPackageList({
                        ip: this.FDIp,
                    }, function (ret) {
                            app.emptyText = app.i18ns.common.noData;
                        if (ret.code == '0') {
                            var data = ret.data[0].data.Members,
                                arr = [];
                            app.FirmwareTypeOptions = []
                            var result = [];
                            for (var i = 0; i < data.length; i++) {
                                var obj = {
                                    SupportModel: data[i].ProductType,
                                    Version: []
                                }
                                for (var j = 0; j < data[i].Version.length; j++) {
                                    var verObj = {
                                        CurrentVer: data[i].Version[j].CurrentVer,
                                        Module: data[i].Version[j].Module,
                                        Selected:true
                                    }
                                    obj.Version.push(verObj)
                                }
                                arr.push(obj)
                                data[i].SupportModel = arr[i].SupportModel;
                                data[i].Version = arr[i].Version;
                                data[i].Status = "Free";
                                var isExist = false;
                                for (var k = 0; k < app.uplistData.length; k++) {
                                    if (data[i].PackageName == app.uplistData[k].PackageName) {
                                        isExist = true;
                                        break;
                                    }
                                }
                                if (!isExist) {
                                    result.push(data[i]);
                                }
                            }
                            for (var i = 0; i < result.length; i++) {
                                for (var j = 0; j < result[i].Version.length; j++) {
                                    var model = {
                                        label: result[i].Version[j].Module,
                                        Module: result[i].Version[j].Module
                                    }
                                    var isP = _.some(app.FirmwareTypeOptions, function (item) {
                                        return item.Module == model.Module
                                    })
                                    if (!isP) {
                                        if(model.Module.indexOf('CPLD')<0){
                                            app.FirmwareTypeOptions.push(model);
                                        }else{
                                            var obj = {
                                                label: 'CPLD',
                                                Module: 'CPLD'
                                            }
                                            if(!_.find(app.FirmwareTypeOptions, function (item) {
                                                return item.Module=='CPLD'
                                            })){
                                                app.FirmwareTypeOptions.push(obj);
                                            }
                                        }
                                    }
                                }
                            }
                            if (app.uplistData.length > 0) {
                                app.allUpgradePackageList = result;
                                app.oldAllPackageList = result;
                            } else {
                                app.allUpgradePackageList = data;
                                app.oldAllPackageList = data;
                            }
                            app.pageInfo1.total = app.allUpgradePackageList.length;
                            if (app.pageInfo1.total > 0) {
                                app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1.pageSize);
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },

                /**
                 * 升级包类型
                 */
                ProductTypeChange: function (val) {},
                FirmwareTypeChange: function (val) {
                    if (val.length <= 0) {
                        this.allUpgradePackageList = this.oldAllPackageList;
                        app.pageInfo1.total = app.allUpgradePackageList.length;
                        if (app.pageInfo1.total > 0) {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1
                                .pageSize);
                        }
                        return false
                    }
                    var arr = [];
                    _.each(this.oldAllPackageList, function (item) {
                        _.each(val,function(elementFirmwareType){
                            if(elementFirmwareType!=='CPLD'){
                                var uuid = [];
                                for (var u = 0; u < arr.length; u++) {
                                    uuid.push(arr[u].UUID)
                                }
                                if (_.some(item.Version, function (ver) {
                                        return elementFirmwareType==ver.Module
                                    })&& uuid.indexOf(item.UUID) === -1) {
                                    arr.push(item)
                                }
                            }else{
                                var uuid = [];
                                for (var u = 0; u < arr.length; u++) {
                                    uuid.push(arr[u].UUID)
                                }
                                _.each(item.Version,function(elementCpld){
                                    if(elementCpld.Module.indexOf('CPLD')>-1&& uuid.indexOf(item.UUID) === -1){
                                        arr.push(item)
                                    }
                                });
                            }
                        })
                        
                    })
                    this.allUpgradePackageList = arr;
                    app.pageInfo1.total = app.allUpgradePackageList.length;
                    if (app.pageInfo1.total > 0) {
                        app.UpgradePackage = app.allUpgradePackageList.slice(0, app.pageInfo1
                            .pageSize);
                    }
                },

                /**
                 * 禁用升级包的复选框
                 */
                checkboxT: function (row, index) {
                    if (row.Status !== "Busy") {
                        return 1;
                    } else {
                        return 0;
                    }
                },
                /**
                 * 选择升级包
                 */
                packageSelectionChange: function (val) {
                    this.checkedPackage = val;
                    this.isCheck()
                },

                //判断是否是E9000包
                notE9000: function (element) {
                    var count = 0;
                    var E9000ProductType = ["CH121 V5", "CH121L V5", "CH221 V5", "CH225 V5", "CH242 V5",
                        "CX320", "CX916", "CX916L", "CX710", "CX920", "MM920", "MM920_MSMB"
                    ];
                    _.each(E9000ProductType, function (n) {
                        if (element.ProductType.indexOf(n) === -1) {
                            count++
                        }
                    });
                    if (count === E9000ProductType.length) {
                        return true
                    } else {
                        return false
                    }
                },
                containsProduct: function (current, target) {
                    var packageNameCheckFlag = _.difference(current.ProductType.split(';'), target
                        .ProductType
                        .split(';')).length < current.ProductType.split(';').length;
                    if (!packageNameCheckFlag) {
                        return false;
                    }
                    return true;
                },
                isCheck: function () {
                    var checkedList = [],
                        data = this.allUpgradePackageList;
                    if (this.checkedPackage.length > 0) {
                        _.each(this.checkedPackage, function (item) {
                            checkedList.push(item.UUID);
                        })
                        _.each(checkedList, function (elementCheck) {
                            _.each(data, function (element) {
                                var versions = [];
                                _.each(element.Version, function (elementVersion) {
                                    versions.push(elementVersion.Module)
                                });
                                if (app.notE9000(element)) {
                                    if (elementCheck === element.UUID && (element.Type ===
                                            "Package_Software" || element.Type ===
                                            "Package_Firmware")) {
                                        _.each(data, function (elementModule) {
                                            if (app.notE9000(elementModule)) {
                                                if (app.containsProduct(element,
                                                        elementModule) && element
                                                    .Version[
                                                        0].Module === elementModule
                                                    .Version[0].Module) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                } else {
                                    if (elementCheck === element.UUID && element.Type ===
                                        "Board_Firmware") {
                                        _.each(data, function (elementModule) {
                                            if (!app.notE9000(elementModule)) {
                                                if (app.containsProduct(element,
                                                        elementModule)) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                    if (elementCheck === element.UUID && element.Type !==
                                        "Board_Firmware") {
                                        _.each(data, function (elementModule) {
                                            if (!app.notE9000(elementModule)) {
                                                if ((app.containsProduct(element,
                                                            elementModule) &&
                                                        element.Version[0]
                                                        .Module ===
                                                        elementModule.Version[0]
                                                        .Module
                                                    ) ||
                                                    (app.containsProduct(element,
                                                            elementModule) &&
                                                        elementModule.Type ===
                                                        "Board_Firmware")) {
                                                    if (element.UUID !==
                                                        elementModule.UUID) {
                                                        elementModule.Status =
                                                            "Busy"
                                                    }
                                                }
                                            }

                                        })
                                    }
                                }
                            });
                            _.each(data, function (element) {
                                if (element.Status === "Busy") {
                                    if (app.notE9000(element)) {
                                        _.each(data, function (ele) {
                                            if (app.notE9000(ele)) {
                                                if ((element.UUID !== ele.UUID &&
                                                        app.containsProduct(
                                                            element, ele) &&
                                                        element.Version[0]
                                                        .Module ===
                                                        ele.Version[0].Module &&
                                                        !_.some(checkedList,
                                                            function (item) {
                                                                return item == ele
                                                                    .UUID
                                                            }) && ele.Status ===
                                                        "Free" && element.Type !==
                                                        "Board_Firmware")) {
                                                    element.Status = "Free"
                                                }
                                            }
                                        })
                                    } else {
                                        _.each(data, function (ele) {
                                            if (!app.notE9000(ele)) {
                                                if ((element.UUID !== ele.UUID &&
                                                        app.containsProduct(
                                                            element, ele) && !_
                                                        .some(
                                                            checkedList,
                                                            function (item) {
                                                                return item == ele
                                                                    .UUID
                                                            }) && ele.Status ===
                                                        "Free" && (element.Type ===
                                                            "Board_Firmware")) || (
                                                        element.UUID !== ele.UUID &&
                                                        element.ProductType === ele
                                                        .ProductType && element
                                                        .Version[
                                                            0].Module === ele
                                                        .Version[
                                                            0].Module && !_.some(
                                                            checkedList,
                                                            function (item) {
                                                                return item == ele
                                                                    .UUID
                                                            }) &&
                                                        ele.Status ===
                                                        "Free" && element.Type !==
                                                        "Board_Firmware")) {
                                                    element.Status = "Free"
                                                }
                                            }

                                        })

                                    }
                                }

                            });

                        })
                    } else {
                        _.each(data, function (elementModule) {
                            elementModule.Status = "Free"
                        });
                    }
                },

                /**
                 * 删除全部
                 */
                deleteAll: function () {
                    this.uplistData = []
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        this.checkdBaseline = []
                        this.baselineData = []
                    } else if (this.upgradeForm.selectMethod == 'UpgradePackage') {
                        this.packageData = []
                    }
                    this.getGroupAndDevice()
                },

                /**
                 * 基线的单选
                 */
                handleradioChange: function (val) {
                    if (val) {
                        this.checkedBaseLine1 = val;
                        this.checkdBaseline = val.FirmwarePackages;
                        this.checkedBaseId = val.UUID;
                        this.baselineRadio = val.UUID;
                    }
                },

                /**
                 * 确定导入已有基线
                 */
                inportSubmit: function () {
                    this.baselineData = JSON.parse(JSON.stringify(this.checkdBaseline)) ;
                    this.uplistData = this.baselineData;
                    this.Baselineisible = false;
                    this.getGroupAndDevice()
                },
                /**
                 * 确定添加升级包
                 */
                packageSubmit: function () {
                    var hasData = [],
                        messageData = [];
                    var checkedList = [],
                        datas = this.uplistData,
                        allDatabackup = JSON.parse(JSON.stringify(this.allUpgradePackageList));
                    _.each(this.checkedPackage, function (item) {
                        checkedList.push(item.UUID);
                    })
                    _.each(checkedList, function (id) {
                        _.each(datas, function (data) {
                            var packagesObj = _.filter(allDatabackup, function (item) {
                                return item.UUID == id
                            })[0];
                            var packageNameCheckFlag = _.difference(packagesObj.ProductType.split(';'), data.SupportModel.split(';')).length < packagesObj.ProductType.split(';').length;
                            if (!packageNameCheckFlag) {
                                packagesObj = null;
                            }
                            if (packagesObj && data.Version.length === 1 && packagesObj
                                .PackageName !==
                                data.PackageName) {
                                if (packagesObj.Version.length === 1) {
                                    if (data.Version[0].Module === packagesObj.Version[0]
                                        .Module) {
                                        hasData.push(packagesObj);
                                        messageData.push({
                                            UUID: packagesObj.UUID,
                                            SupportModel: packagesObj.SupportModel,
                                            hasVersion: data.Version,
                                            replaceVersion: packagesObj.Version
                                        });
                                    }
                                } else {
                                    hasData.push(packagesObj);
                                    messageData.push({
                                        UUID: packagesObj.UUID,
                                        SupportModel: packagesObj.SupportModel,
                                        hasVersion: data.Version,
                                        replaceVersion: packagesObj.Version
                                    });
                                }
                            } else if (packagesObj && packagesObj.PackageName !== data
                                .PackageName) {
                                hasData.push(packagesObj);
                                messageData.push({
                                    UUID: packagesObj.UUID,
                                    SupportModel: packagesObj.SupportModel,
                                    hasVersion: data.Version,
                                    replaceVersion: packagesObj.Version
                                });
                            }
                        })
                    });
                    hasData = _.uniq(hasData);

                    if (hasData.length === 0) {
                        _.each(checkedList, function (id) {
                            var messageDataObj = _.filter(allDatabackup, function (item) {
                                return item.UUID == id
                            })[0];
                            var scopeHasPackage = _.filter(datas, function (item) {
                                return item.PackageName == messageDataObj.PackageName &&
                                    item.SupportModel == messageDataObj.SupportModel
                            })[0];
                            if (!!messageDataObj && !scopeHasPackage) {
                                messageDataObj.SupportModel = messageDataObj.SupportModel;
                                datas.push(messageDataObj)
                            }
                        });
                        this.packageData = datas;
                        this.UpgradePackageisible = false;
                        this.getGroupAndDevice()
                    } else {
                        app.addPackageDialogisible = true;
                        app.messageData = messageData;
                        var messageCheckedList = [];
                        app.messageChecked = [];
                        Vue.nextTick(function () {
                            _.each(messageData, function (item) {
                                messageCheckedList.push(item.UUID);
                                app.$refs.addReplacePackage.toggleRowSelection(item, true);
                            })
                        })
                        this.messageCheckedList = messageCheckedList;
                        this.hasData = hasData;
                    }
                    app.baselineRadio = '';
                },
                /**
                 * 添加升级包时的 替换的选择
                 */
                addPackageReplaceChange: function (val) {
                    this.messageChecked = val;
                },
                /**
                 * 添加升级包时的 替换
                 */
                addReplacePackageSubmit: function () {
                    var deletePackagesArr = [];
                    var datas = this.uplistData,
                        allDatabackup = JSON.parse(JSON.stringify(this.allUpgradePackageList)),
                        hasData = this.hasData,
                        checkedList = [];
                    _.each(this.checkedPackage, function (item) {
                        checkedList.push(item.UUID);
                    })
                    _.each(this.messageCheckedList, function (id) {
                        var hasObj = _.filter(hasData, function (item) {
                            return item.UUID == id
                        })[0];
                        _.each(datas, function (data) {
                            if (hasObj.Version.length === 1) {
                                if (data.Version.length === 1) {
                                    if (data.Version[0].Module === hasObj.Version[
                                            0].Module && _.difference(hasObj.SupportModel
                                            .split(
                                                ';'), data.SupportModel.split(';')).length <
                                        hasObj.SupportModel.split(';').length) {
                                        deletePackagesArr.push(data);
                                    }
                                } else if (_.difference(hasObj.SupportModel.split(
                                        ';'), data.SupportModel.split(';')).length <
                                    hasObj.SupportModel.split(';').length) {
                                    deletePackagesArr.push(data);
                                }
                            } else if (_.difference(hasObj.SupportModel.split(
                                    ';'), data.SupportModel.split(';')).length <
                                hasObj.SupportModel.split(';').length) {
                                deletePackagesArr.push(data);
                            }
                        });
                    });
                    _.each(deletePackagesArr, function (deleteObj) {
                        datas = _.without(datas, _.filter(datas, function (item) {
                            return item.PackageName == deleteObj.PackageName && item
                                .SupportModel ==
                                deleteObj.SupportModel
                        })[0]);
                    });
                    _.each(hasData, function (data) {
                        if (app.messageCheckedList.indexOf(data.UUID) === -1) {
                            checkedList = _.without(checkedList, data.UUID);
                        }
                    });
                    _.each(checkedList, function (id) {
                        var messageDataObj = _.filter(allDatabackup, function (item) {
                            return item.UUID == id
                        })[0];
                        var scopeHasPackage = _.filter(datas, function (item) {
                            return item.PackageName == messageDataObj.PackageName && item
                                .SupportModel ==
                                messageDataObj.SupportModel
                        })[0];
                        if (!!messageDataObj && !scopeHasPackage) {
                            messageDataObj.SupportModel = messageDataObj.SupportModel;
                            datas.push(messageDataObj)
                        }
                    });
                    this.uplistData = datas;
                    this.packageData = datas;
                    app.addPackageDialogisible = false;
                    this.UpgradePackageisible = false;
                    this.getGroupAndDevice()
                },
                /**
                 * 删除单个基线版本信息
                 */
                deleteOne: function (row, index) {
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        this.baselineData.splice(index, 1)
                    } else if (this.upgradeForm.selectMethod == 'UpgradePackage') {
                        this.packageData.splice(index, 1)
                    }
                    if (this.uplistData.length == 0) {
                        this.baselineRadio = '';
                    }
                    this.getGroupAndDevice()
                },
                /**
                 * 清空组选择
                 */
                clearGroup: function () {
                    this.deviceData = []
                    this.groupDevices = [];
                    this.batchDevice = [{
                        list: app.uniq(app.groupDevices, app.serviceData)
                    }];
                },
                /**
                 * 添加组选择
                 */
                add: function () {
                    this.deviceDialog = true;
                    this.getGroupsList()
                },
                /**
                 * 组弹窗的选择事件
                 */
                handleSelectDevice: function (val) {
                    this.checkedDevice = val;
                    this.checkedDeviceNum = val.length;
                },
                /**
                 * 确定添加组
                 */
                ensureDevice: function () {
                    this.deviceDialog = false;
                    this.deviceData = this.checkedDevice;
                    if (this.checkedDevice.length > 0) {
                        this.groupDevice()
                    }
                },
                /**
                 * 所选组 所包含的设备
                 */
                groupDevice: function () {
                    var queryParam = {
                        BaselineInfo: {},
                        Filter: {
                            GroupIDs: [],
                            ProductTypes: [],
                            BMCIP: "",
                            Skip: 0,
                            Top: 0
                        },
                        PackageInfos: [],
                        VersionType: ""
                    }
                    if (this.deviceData.length > 0) {
                        _.each(this.deviceData, function (item) {
                            queryParam.Filter.GroupIDs.push(item.ID + "")
                        })
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.VersionType = 'Baseline';
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        queryParam.VersionType = 'UpgradePackage';
                        for (var i = 0; i < this.uplistData.length; i++) {
                            // if (this.uplistData[i].Version) {
                            var obj = {
                                PackageID: this.uplistData[i].UUID,
                                Module: []
                            }
                            if (this.uplistData[i].Version) {
                                for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                    obj.Module.push(this.uplistData[i].Version[k].Module)
                                }
                            }
                            queryParam.PackageInfos.push(obj)
                            // }
                        }
                    }
                    app.groupDevices = [];
                    upgradePackageManage.groupDevice({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        if (ret.code == '0') {
                            if(ret.data[0].data.Devices){
                                var data = ret.data[0].data.Devices;
                                for(var i=0;i<data.length;i++){
                                    if(data[i].CanUpgrade){
                                        app.groupDevices.push(data[i])
                                    }
                                }
                            }else{
                                app.groupDevices = [];
                            }
                            if (app.serviceData.length <= 0 && app.groupDevices.length <= 0) {
                                app.ExecutionPolicy = "Period";
                            }
                            app.batchDevice = [{
                                list: app.uniq(app.groupDevices, app.serviceData)
                            }];
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            // alertMsg(msg);
                        }
                    })
                },
                /**
                 * 删除已选组
                 */
                handleDelete: function (row, index) {
                    this.deviceData.splice(index, 1);
                    if(this.deviceData.length>0&&this.uplistData.length>0){
                        this.groupDevice()
                    }else if(this.deviceData.length<=0){
                        app.groupDevices = [];
                        if (app.serviceData.length <= 0 && app.groupDevices.length <= 0) {
                            app.ExecutionPolicy = "Period";
                        }
                        app.batchDevice = [{
                            list: app.uniq(app.groupDevices, app.serviceData)
                        }];
                    }
                },
                /**
                 * 获取组的列表
                 */
                getGroupList: function () {
                    app.deviceList = [];
                    upgradePackageManage.getAllGRoupList({
                        ip: this.FDIp
                    }, function (ret) {
                        if (ret.code == '0') {
                            if (ret.data[0].data.Groups) {
                                var da = ret.data[0].data.Groups;
                                for (var i = 0; i < da.length; i++) {
                                    if (da[i].ID > 0) {
                                        ret.data[0].data.Groups[i].Enable = true;
                                        ret.data[0].data.Groups[i].EnableLabel = '';
                                        app.deviceList.push(ret.data[0].data.Groups[i]);
                                    }
                                }
                            }
                            app.deviceNum = ret.data[0].data['Members@odata.count'];
                            if (app.deviceList.length > 0) {
                                app.checkGroup();
                            } else {
                                app.isCheckgroup = false;
                            }
                            app.getItemDetail()
                        } else {

                            setTimeout(function () {
                                app.editLoading = false;
                            }, intervalTime); //延迟半秒在关闭loading
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },
                /**
                 * 获取组的列表
                 */
                getGroupsList: function () {
                    upgradePackageManage.getAllGRoupList({
                        ip: this.FDIp
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.deviceList = [];
                            if (ret.data[0].data.Groups) {
                                var da = ret.data[0].data.Groups;
                                for (var i = 0; i < da.length; i++) {
                                    if (da[i].ID > 0) {
                                        ret.data[0].data.Groups[i].Enable = true;
                                        ret.data[0].data.Groups[i].EnableLabel = '';
                                        app.deviceList.push(ret.data[0].data.Groups[i]);
                                    }
                                }
                            }
                            app.deviceNum = ret.data[0].data['Members@odata.count'];
                            for (var i = 0; i < app.deviceList.length; i++) {
                                if (_.some(app.deviceData, function (item) {
                                        return item.ID == app.deviceList[i].ID;
                                    })) {
                                    (function (arg) {
                                        Vue.nextTick(function () {
                                            app.$refs.nodeTable.toggleRowSelection(arg,true);
                                        })
                                    })(app.deviceList[i])
                                }
                            }
                            if (app.deviceList.length > 0) {
                                app.checkGroup();
                            } else {
                                app.isCheckgroup = false;
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },
                /**
                 * 检查组的可用
                 */
                checkGroup: function () {
                    var queryParam = {
                        GroupIDs: []
                    };
                    _.each(this.deviceList, function (item) {
                        queryParam.GroupIDs.push(item.ID + "")
                    })
                    if (queryParam.GroupIDs.length > 0) {
                        upgradePackageManage.checkGeoup({
                            ip: this.FDIp,
                            data: queryParam
                        }, function (ret) {
                            if (ret.code == '0') {
                                app.isCheckGroup = ret.data[0].data.EnableGroupIDs ? ret.data[0].data.EnableGroupIDs : [];
                                if (app.isCheckGroup && app.isCheckGroup.length > 0) {
                                    _.each(app.deviceList, function (item) {
                                        _.each(app.isCheckGroup, function (check) {
                                            if (item.ID == check) {
                                                app.isCheckgroup = true;
                                            }
                                        })
                                        var originDeviceGroups = [];
                                        _.each(app.oldDeviceGroupData, function (dev) {
                                            originDeviceGroups.push(dev.ID)
                                        })
                                        if (!_.some(originDeviceGroups, function (group) {
                                                return group == item.ID
                                            })) {
                                            if (app.isCheckGroup.indexOf(item.ID
                                                    .toString()) !== -1) {
                                                item.Enable = false;
                                                item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_notUsed;
                                            } else {
                                                item.Enable = true;
                                                item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_usedPlan;
                                            }
                                        } else {
                                            item.Enable = false;
                                            item.EnableLabel = app.i18ns.upgradePlan.upgradePlan_usedCurrentPlan;
                                        }
                                    })

                                } else {
                                    app.isCheckgroup = false;
                                    _.each(app.deviceList, function (
                                        EnableGroup) {
                                        EnableGroup.Enable = true;
                                        EnableGroup.EnableLabel = app.i18ns.upgradePlan
                                            .upgradePlan_usedPlan;
                                    });
                                }
                            } else {
                                if (ret.ip != app.FDIp) {
                                    return false
                                }
                                var msg = getErrorMsg(ret);
                                alertMsg(msg);
                            }
                        })
                    } else {
                        _.each(this.deviceList, function (
                            EnableGroup) {
                            EnableGroup.Enable = false;
                            EnableGroup.EnableLabel = app.i18ns.upgradePlan.upgradePlan_notUsed;
                        });
                    }

                },

                /**
                 * 是否组可选
                 */
                checkboxGroupT: function (row, index) {
                    if (row.Enable) {
                        return false;
                    } else {
                        return true;
                    }
                },
                /**
                 * 获取单个组详情
                 */
                showGroupDetil: function (name) {
                    this.groupItemTit = name;
                    this.groupDialog = true;
                    upgradePackageManage.getGroupItemDetail({
                        ip: this.FDIp,
                        name: name,
                        pageNo: 1,
                        pageSize: 10
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.groupItem = ret.data[0].data.Members
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },
                detailsDeviceInfo: function (row) {
                    if(row.ProductType=='E9000'){
                        this.serverData = [];
                        this.managerData = [];
                        this.switchData = [];
                        this.fanData = [];
                        if(row.Devices&&row.Devices.length>0){
                            app.serverData=_.filter(row.Devices,function(item){
                                return item.DeviceType == 'Server'
                            });
                            app.managerData = _.filter(row.Devices,function(item){
                                return item.DeviceType == 'Manager'
                            });
                            app.switchData = _.filter(row.Devices,function(item){
                                return item.DeviceType == 'Switch'
                            });
                            app.fanData = _.filter(row.Devices,function(item){
                                return item.DeviceType != 'Server'&&item.DeviceType != 'Manager'&&item.DeviceType != 'Switch'
                            });
                        }
                        this.deviceTit = row.HostName;
                        this.preciseDetailDialog=true;
                    }else{
                        this.deviceInfo = row.ModulesInfo;
                        this.deviceItemTit = row.BMCIP;
                        this.$refs.deviceInfoDialog.show();
                    }
                },
                /**
                 * 获取设备的固件详情
                 */
                detailsInfo: function (row) {
                    var queryParam = {
                        DeviceID: "",
                        VersionType: ""
                    }
                    if (row.IPv4Address) {
                        this.deviceItemTit = row.IPv4Address.Address;
                        queryParam.DeviceID = row.DeviceID;
                    } else if (row.BMCIP) {
                        this.deviceItemTit = row.BMCIP;
                        queryParam.DeviceID = row.ID;
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.VersionType = 'Baseline';
                        queryParam.BaselineInfo = {
                            BaselineID: this.checkedBaseId,
                            FirmwarePackages: []
                        };
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        queryParam.VersionType = 'UpgradePackage';
                        queryParam.PackageInfos = [];
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageID: this.uplistData[i].UUID,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            queryParam.PackageInfos.push(obj)
                        }
                    }
                    upgradePackageManage.getDetailsInfo({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.deviceInfo = ret.data[0].data.ModulesInfo;
                            app.$refs.deviceInfoDialog.show();
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },

                /**
                 * 清空设备
                 */
                clearService: function () {
                    this.serviceData = [];
                    this.batchDevice = [{
                        list: app.uniq(app.groupDevices, app.serviceData)
                    }];
                },
                /**
                 * 删除已选设备
                 */
                handleDeleteS: function (row, index) {
                    this.serviceData.splice(index, 1)
                    if (this.serviceData.length <= 0 && this.groupDevices.length <= 0) {
                        this.ExecutionPolicy = "Period";
                    }
                    this.batchDevice = [{
                        list: app.uniq(app.groupDevices, app.serviceData)
                    }];
                },
                /**
                 * 添加设备
                 */
                addService: function () {
                    this.serviceDialog = true;
                    this.productData = [];
                    this.productTypes = [];
                    this.groupOptions = [];
                    this.deviceProductTypes = [];
                    this.groupDev = [];
                    this.productValueValue = "";
                    this.getDeviceType()
                    this.groupOwern()
                    this.checkedService = [];
                    this.deviceChecked = JSON.parse(JSON.stringify(this.serviceData));
                    this.getSerList()
                },
                /**
                 * 设备的产品类型
                 */
                getDeviceType: function () {
                    this.productTypes = [];
                    upgradePackageManage.getProduct({
                        ip: this.FDIp,
                    }, function (ret) {
                        if (ret.code == '0') {
                            app.productData = ret.data[0].data.ProductType;
                            var productData = ret.data[0].data;
                            if (app.checkDataIsValid(productData) && app.checkDataIsValid(
                                    productData.ProductType)) {
                                if (productData.ProductType.length > 0) {
                                    app.productTypes = [{
                                        id: 'all',
                                        label: app.i18ns.upgradePackageWarehouse
                                            .versionWarehouse_all
                                    }]
                                }
                                _.each(productData.ProductType, function (m) {
                                    var optionProduct = {
                                        id: "",
                                        label: ""
                                    };
                                    optionProduct.id = m;
                                    optionProduct.label = m;
                                    app.productTypes.push(optionProduct);
                                })
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },
                /**
                 * 所属组
                 */
                groupOwern: function () {
                    this.groupOptions = [];
                    upgradePackageManage.getAllGRoupList({
                        ip: this.FDIp
                    }, function (ret) {
                        if (ret.code == '0') {
                            var groupsData = ret.data[0].data;
                            if (app.checkDataIsValid(groupsData) && app.checkDataIsValid(
                                    groupsData.Groups)) {
                                _.each(groupsData.Groups, function (n) {
                                    var optionGroup = {
                                        id: "",
                                        label: ""
                                    };
                                    optionGroup.id = n.ID;
                                    optionGroup.label = n.Name === 'NULL' ? app.i18ns
                                        .upgradePlan
                                        .upgradePlan_nullGroup :
                                        n.Name;
                                    app.groupOptions.push(optionGroup);
                                })
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    })
                },
                /**
                 * 选择所属组
                 */
                changeGroupOwern: function (val) {
                    this.getSerList()
                },
                /**
                 * 选择产品类型
                 */
                changeType: function (val) {
                    if (val == 'all') {
                        this.deviceProductTypes = this.productData;
                    } else {
                        this.deviceProductTypes = [this.productValueValue]
                    }
                    this.getSerList()
                },
                /**
                 * 设备弹窗的选择事件
                 */
                handleSelectS: function (val) {
                    this.deviceChecked = JSON.parse(JSON.stringify(val));
                },
                selectItem: function (val, item) {
                    if (_.some(val, function (o) { //选中
                            return o.ID == item.ID
                        })) {
                        for (var index = 0; index < val.length; index++) {
                            if (!_.some(this.deviceChecked, function (o) {
                                    return o.ID == val[index].ID
                                })) {
                                this.deviceChecked.push(item)
                            }
                        }
                    } else {
                        this.deviceChecked.splice(_.findIndex(app.deviceChecked, function (o) {
                            return o.ID == item.ID
                        }), 1)
                    }
                },
                /**
                 * 确定添加设备
                 */
                ensureService: function () {
                    this.checkedService = JSON.parse(JSON.stringify(this.deviceChecked))
                    this.serviceData = this.checkedService;
                    this.serviceDialog = false;
                    //可以分批升级的设备
                    app.batchDevice = [{
                        list: app.uniq(app.groupDevices, app.serviceData)
                    }];
                },
                /**
                 * 禁用设备的复选框
                 */
                checkboxDeviceT: function (row, index) {
                    if (!row.CanUpgrade) {
                        return false;
                    } else {
                        return true;
                    }
                },
                /**
                 * 获取设备的列表
                 */
                getSerList: function () {
                    this.editLoading=true;
                    var queryParam = {
                        BaselineInfo: {},
                        Filter: {
                            GroupIDs: [],
                            ProductTypes: [],
                            BMCIP: "",
                            Skip: 0,
                            Top: 0
                        },
                        PackageInfos: [],
                        VersionType: ""
                    }
                    if (this.groupDev.length > 0) {
                        queryParam.Filter.GroupIDs = this.groupDev.join().split(',');
                    }
                    if (this.deviceProductTypes.length > 0) {
                        queryParam.Filter.ProductTypes = this.deviceProductTypes;
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.VersionType = 'Baseline';
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                if(this.uplistData[i].Version[k].Selected){
                                obj.Module.push(this.uplistData[i].Version[k].Module)
                            }
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        queryParam.VersionType = 'UpgradePackage';
                        for (var i = 0; i < this.uplistData.length; i++) {
                            if (this.uplistData[i].Version) {
                                var obj = {
                                    PackageID: this.uplistData[i].UUID,
                                    Module: []
                                }
                                for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                    if(this.uplistData[i].Version[k].Selected){
                                    obj.Module.push(this.uplistData[i].Version[k].Module)
                                }
                                }
                                queryParam.PackageInfos.push(obj)
                            }

                        }
                    }
                    app.serviceList = [];
                    app.serData = [];
                    app.ensData = [];
                    app.emptyText = app.i18ns.common.loading;
                    app.numberTime = 2;
                    this.callBackSer(queryParam);
                    this.callBackEnsure(queryParam)
                    var deviceChecked = JSON.parse(JSON.stringify(this.serviceData));
                    app.serviceData = [];
                    var t = setInterval(function(){
                        if(app.numberTime==0){
                            clearInterval(t)
                            setTimeout(function(){
                                app.editLoading=false;
                            },500)
                            app.emptyText = app.i18ns.common.noData;
                            app.serviceList = _.concat(app.serData,app.ensData)
                            var newDevices=[],isUpdateBatch=false;
                            if(app.serviceList.length>0){
                                for (var i = 0; i < app.serviceList.length; i++) {
                                    if (_.some(deviceChecked, function (item) {
                                            return item.ID == app.serviceList[i].ID;
                                        })) { 
                                            if(app.serviceDialog==true){
                                                (function (arg) {
                                                    Vue.nextTick(function () {
                                                        app.$refs.serviceList.toggleRowSelection(arg, true);
                                                    })
                                                })(app.serviceList[i])
                                            }
                                            //判断最新的升级包或者基线是否包含旧的 设备的数据进行更新
                                            if(app.serviceList[i].CanUpgrade==true){
                                                newDevices.push(app.serviceList[i])
                                            }
                                    }else{
                                        isUpdateBatch = true;
                                    }
                                }
                                app.serviceData = newDevices;
                            }else{
                                app.serviceData = [];
                                isUpdateBatch = true;
                            }
                            if(app.serviceDialog==false){
                                app.batchDevice = [{
                                    list: app.uniq(app.groupDevices, app.serviceData)
                                }];
                            }
                        }
                    },50)
                },
                selectServer:function(){
                    var deviceChecked = this.deviceChecked;
                    for (var i = 0; i < app.serviceList.length; i++) {
                        if (_.some(deviceChecked, function (item) {
                                return item.ID == app.serviceList[i].ID;
                            })) { 
                            (function (arg) {
                                Vue.nextTick(function () {
                                    app.$refs.serviceList.toggleRowSelection(arg, true);
                                })
                            })(app.serviceList[i])
                        }
                    }
                },
                /**
                 * 服务器设备
                 */
                callBackSer: function (queryParam) {
                    upgradePackageManage.getAllDeviceList({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        app.numberTime --;
                        if (ret.code == '0') {
                            app.serData = ret.data[0].data.Devices ? app.serData.concat(ret.data[0].data.Devices) :
                                app.serData;
                            app.serviceNum = ret.data[0].data['Devices@odata.count'];
                            app.MINSPVersion = ret.data[0].data.MINSPVersion;
                            app.MINSPVersionTip = app.i18ns.upgradePlan.upgradePlan_lessThanSPVersion.format(app.MINSPVersion);
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            // alertMsg(msg);
                        }
                    })
                },
                /**
                 * 机框设备
                 */
                callBackEnsure: function (queryParam) {
                    upgradePackageManage.getEnclosureInfo({
                        ip: this.FDIp,
                        data: queryParam
                    }, function (ret) {
                        app.numberTime --;
                        if (ret.code == '0') {
                            if (app.checkDataIsValid(ret.data[0].data) && app.checkDataIsValid(ret.data[0].data.EnclosureFirmwareInfo)) {
                                var frameSrcData = ret.data[0].data.EnclosureFirmwareInfo;
                                _.each(frameSrcData, function (elementDevice) {
                                    elementDevice.BMCIP = elementDevice.HostName;
                                    elementDevice.CanUpgrade = true;
                                    elementDevice.ID = elementDevice.Id;
                                    for (var j = 0; j < elementDevice.Devices.length; j++) {
                                        elementDevice.Devices[j].Selected=true
                                    }
                                });
                                app.frameSrcData = frameSrcData;
                                app.ensData = app.ensData.concat(frameSrcData);
                            }
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            // alertMsg(msg);
                        }
                    })
                },
                isType: function () {
                    this.productYesE9000 = [];
                    this.productNoE9000 = [];
                    _.each(this.uplistData, function (elementBaseline) {
                        if (elementBaseline.SupportModel.indexOf("CH121 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH121L V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH221 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH225 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH242 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX320") === -1 &&
                            elementBaseline.SupportModel.indexOf("CH242 V5") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX916") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX916L") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX710") === -1 &&
                            elementBaseline.SupportModel.indexOf("CX920") === -1 && elementBaseline
                            .SupportModel.indexOf("MM920") === -1 &&
                            elementBaseline.SupportModel.indexOf("MM920_MSMB") === -1) {
                            elementBaseline.product = "Server";
                            app.productNoE9000.push("Server");
                        } else {
                            app.productYesE9000.push("E9000");
                            elementBaseline.product = "E9000";
                        }
                    });
                    if (this.productNoE9000.length > 0 && this.productYesE9000.length === 0) {
                        this.deviceTypeProductFlag = "Server";
                    } else if (this.productNoE9000.length === 0 && this.productYesE9000.length > 0) {
                        this.deviceTypeProductFlag = "E9000";
                    } else if (this.productNoE9000.length > 0 && this.productYesE9000.length > 0) {
                        this.deviceTypeProductFlag = "Combine";
                    }
                },
                /**
                 * 提交
                 */
                 submitPlan:function(){
                     if(this.upgradeForm.PlanName!=this.oldPlanName&&this.upgradeForm.PlanName!=""){
                        this.$refs['upgradeForm'].validate(function (valid) {
                            if (valid) {
                                //检测计划名称重复
                                upgradePackageManage.checkPlanName({
                                    ip: app.FDIp,
                                    data: {
                                        PlanName: app.upgradeForm.PlanName
                                    }
                                }, function (ret) {
                                    if (ret.code == '0') {
                                        if (ret.data[0].data.PlanName) {
                                            app.submitPlanVaild()
                                        } else {
                                            app.$message({
                                                message: app.i18ns.upgradePlan .upgradePlan_nameRepeatTip,
                                                type: 'error'
                                            });
                                        }
                                    } else {
                                        if (ret.ip != app.FDIp) { return false }
                                        var msg = getErrorMsg(ret);
                                        alertMsg(msg);
                                    }
                                });
                            } else {
                                return false;
                            }
                        })
                     }else{
                         this.submitPlanVaild()
                     }
                    
                 },
                submitPlanVaild: function () {
                    if (this.upgradeSwitch && app.batchDevice.length <= 1) {
                        app.$message({
                            message: app.i18ns.upgradePlan.upgradePlan_addImportDeviceTip,
                            type: 'error'
                        });
                        return
                    } else if (this.upgradeSwitch && app.batchDevice.length > 10) {
                        app.$message({
                            message: app.i18ns.upgradePlan.upgradePlan_addImportDeviceTenTip,
                            type: 'error'
                        });
                        return
                    }
                    var queryParam = {
                        BaselineInfo: {},
                        Description: "",
                        DeviceGroupIDs: [],
                        EnclosureInfo: [],
                        ExecutionPolicy: "",
                        Name: "",
                        PackageInfos: [],
                        ResetImmediately: false,
                        SpecifiedTime: "",
                        TaskFlow: [],
                        Type: "Firmware",
                        VersionType: "",
                    };
                    queryParam.ExecutionPolicy = this.ExecutionPolicy;
                    queryParam.Name = this.upgradeForm.PlanName;
                    queryParam.Description = this.upgradeForm.Description;
                    queryParam.VersionType = this.upgradeForm.selectMethod;
                    queryParam.ResetImmediately = this.EffectPolicy;
                    for (var k = 0; k < this.frameSrcData.length; k++) {
                        var obj = {
                            Devices:[],
                            EnclosureID:this.frameSrcData[k].ID
                        } 
                        for (var i = 0; i < this.frameSrcData[k].Devices.length; i++) {
                            var devices = {
                                DeviceType:this.frameSrcData[k].Devices[i].DeviceType,
                                Index:this.frameSrcData[k].Devices[i].Index
                            }
                            obj.Devices.push(devices)
                        }
                        queryParam.EnclosureInfo.push(obj)
                    }
                    if (this.ExecutionPolicy == 'SpecifiedTime') {
                        var oldDate = sessionStorage.getItem('serverDate');
                        if (this.oldTime) {
                            oldDate = this.oldTime;
                        } else {
                            oldDate = sessionStorage.getItem('serverDate');
                        }
                        var difference = (Date.parse(this.SpecifiedTime) - Date.parse(
                            (oldDate.replace(/-/g, "/")))) / 1000;
                        if (difference >= 60) {
                            queryParam.SpecifiedTime = parseTime(this.SpecifiedTime);;
                        } else {
                            app.$message({
                                message: app.i18ns.upgradePlan.upgradePlan_differenceTip.format(
                                    parseTime(oldDate)),
                                type: 'error'
                            });
                            return
                        }

                    } else {
                        queryParam.SpecifiedTime = ''
                    }
                    if (this.deviceData.length > 0) {
                        for (var i = 0; i < this.deviceData.length; i++) {
                            queryParam.DeviceGroupIDs.push(this.deviceData[i].ID + "")
                        }
                    }
                    if (this.batchDevice.length > 0) {
                        _.each(this.batchDevice, function (device, index) {
                            var obj = {
                                BatchInterval: device.timeDelay ? device.timeDelay * 60 : 0,
                                DeviceIDs: [],
                                FlowNumber: index + 1,
                                GroupDeviceIDs: []
                            }
                            queryParam.TaskFlow.push(obj)
                            for (var j = 0; j < device.list.length; j++) {
                                if (app.serviceData.length > 0) {
                                    for (var i = 0; i < app.serviceData.length; i++) {
                                        if (app.serviceData[i].ID == device.list[j].ID) {
                                            queryParam.TaskFlow[index].DeviceIDs.push(app
                                                .serviceData[
                                                    i].ID)
                                        }
                                    }
                                }
                                if (app.groupDevices.length > 0) {
                                    for (var i = 0; i < app.groupDevices.length; i++) {
                                        if (app.groupDevices[i].ID == device.list[j].ID) {
                                            if (!_.some(queryParam.TaskFlow[index].DeviceIDs,
                                                    function (item) {
                                                        return item == app.groupDevices[i].ID
                                                    })) {
                                                queryParam.TaskFlow[index].GroupDeviceIDs.push(app
                                                    .groupDevices[
                                                        i].ID)
                                            }
                                        }
                                    }
                                }
                            }

                        })
                    }
                    if (this.upgradeForm.selectMethod == 'Baseline') {
                        queryParam.BaselineInfo.BaselineID = this.checkedBaseId;
                        var arr = []
                        for (var i = 0; i < this.uplistData.length; i++) {
                            var obj = {
                                PackageName: this.uplistData[i].PackageName,
                                ProductType: this.uplistData[i].SupportModel,
                                Module: []
                            }
                            for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                if(this.uplistData[i].Version[k].Selected){
                                    obj.Module.push(this.uplistData[i].Version[k].Module)
                                }
                            }
                            arr.push(obj)
                        }
                        queryParam.BaselineInfo.FirmwarePackages = arr;
                    } else {
                        for (var i = 0; i < this.uplistData.length; i++) {
                            if (this.uplistData[i].Version) {
                                var obj = {
                                    PackageID: this.uplistData[i].UUID,
                                    Module: []
                                }
                                for (var k = 0; k < this.uplistData[i].Version.length; k++) {
                                    if(this.uplistData[i].Version[k].Selected){
                                        obj.Module.push(this.uplistData[i].Version[k].Module)   
                                    }
                                }
                                queryParam.PackageInfos.push(obj)
                            }
                        }
                    }
                    if (queryParam.ResetImmediately || queryParam.ExecutionPolicy == 'Immediate') {
                        var tips = app.i18ns.upgradePlan.upgradePlan_activeEffectTip;
                        var type = 'warning';
                        if (queryParam.ExecutionPolicy === 'Immediate' && !queryParam.ResetImmediately) {
                            type = "prompt";
                            tips = app.i18ns.upgradePlan.upgradePlan_ImedAfterEffectTip;
                        } else if (queryParam.ExecutionPolicy === 'Immediate' && queryParam
                            .ResetImmediately) {
                            type = "warning";
                            tips = app.i18ns.upgradePlan.upgradePlan_activeImedEffectTip;
                        } else if (queryParam.ExecutionPolicy !== 'Immediate' && queryParam
                            .ResetImmediately) {
                            type = "warning";
                            tips = app.i18ns.upgradePlan.upgradePlan_activeEffectTip;
                        }
                        this.$confirm(tips, app.i18ns.common.warn, {
                            confirmButtonText: app.i18ns.common.confirm,
                            cancelButtonText: app.i18ns.common.cancel,
                            closeOnClickModal: false,
                            type: type
                        }).then(function () {
                            app.ensureSubmitPlan(queryParam)
                        }).catch(function () {})
                    } else {
                        this.ensureSubmitPlan(queryParam)
                    }
                },
                /**
                 * 提交请求
                 */
                ensureSubmitPlan: function (queryParam) {
                    this.subDisabled = true;
                    upgradePackageManage.updateUpgradePlanById({
                        ip: this.FDIp,
                        data: queryParam,
                        id: app.ID
                    }, function (ret) {
                        app.subDisabled = false;
                        if (ret.code == '0') {
                            window.location.href = './index.html';
                        } else {
                            if (ret.ip != app.FDIp) {
                                return false
                            }
                            var msg = getErrorMsg(ret);
                            alertMsg(msg);
                        }
                    });
                },
                /**
                 *  返回按钮方法 
                 * **/
                back: function () {
                    window.location.href = './index.html?s=' + Math.random();
                },
                /**
                 * 分批升级
                 */
                toggleSwitch: function () {
                    if (!this.upgradeSwitch) {
                        this.batchDevice = [{
                            list: app.uniq(app.groupDevices, app.serviceData)
                        }];
                    } else {
                        if (this.ExecutionPolicy == 'Period') {
                            app.ExecutionPolicy = 'Immediate'
                        }
                    }
                },
                /**
                 * 设置当前显示数据的总数
                 * 
                 * @param {any} val 
                 */
                pageInfo1HandleSizeChange: function (val) {
                    this.pageInfo1.pageSize = val;
                    if (this.pageInfo1.total > 0) {
                        if (this.pageInfo1.currentPage > 1) {
                            var startIndex = (this.pageInfo1.currentPage - 1) * this.pageInfo1.pageSize;
                            var endIndex = startIndex + this.pageInfo1.pageSize;
                            app.UpgradePackage = app.allUpgradePackageList.slice(startIndex, endIndex);
                        } else {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, this.pageInfo1
                                .pageSize);
                        }
                    }
                },
                /**
                 * 切换当前显示页
                 * 
                 * @param {any} val 
                 */
                pageInfo1HandleCurrentChange: function (val) {
                    this.pageInfo1.currentPage = val;
                    if (this.pageInfo1.total > 0) {
                        if (this.pageInfo1.currentPage > 1) {
                            var startIndex = (this.pageInfo1.currentPage - 1) * this.pageInfo1.pageSize;
                            var endIndex = startIndex + this.pageInfo1.pageSize;
                            app.UpgradePackage = app.allUpgradePackageList.slice(startIndex, endIndex);
                        } else {
                            app.UpgradePackage = app.allUpgradePackageList.slice(0, this.pageInfo1
                                .pageSize);
                        }
                    }
                },


                /**
                 * 设置当前显示数据的总数
                 * 
                 * @param {any} val 
                 */
                pageInfo2HandleSizeChange: function (val) {
                    this.pageInfo2.pageSize = val;
                    if (this.pageInfo2.total > 0) {
                        if (this.pageInfo2.currentPage > 1) {
                            var startIndex = (this.pageInfo2.currentPage - 1) * this.pageInfo2.pageSize;
                            var endIndex = startIndex + this.pageInfo2.pageSize;
                            app.baseLinelistData = app.allBaseLinelist.slice(startIndex, endIndex);
                        } else {
                            app.baseLinelistData = app.allBaseLinelist.slice(0, this.pageInfo2.pageSize);
                        }
                    }
                },
                /**
                 * 切换当前显示页
                 * 
                 * @param {any} val 
                 */
                pageInfo2HandleCurrentChange: function (val) {
                    this.pageInfo2.currentPage = val;
                    if (this.pageInfo2.total > 0) {
                        if (this.pageInfo2.currentPage > 1) {
                            var startIndex = (this.pageInfo2.currentPage - 1) * this.pageInfo2.pageSize;
                            var endIndex = startIndex + this.pageInfo2.pageSize;
                            app.baseLinelistData = app.allBaseLinelist.slice(startIndex, endIndex);
                        } else {
                            app.baseLinelistData = app.allBaseLinelist.slice(0, this.pageInfo2.pageSize);
                        }
                    }
                },

                /**
                 * 分批升级
                 */
                showBatch: function (obj) {
                    this.otherList = obj.list;
                    this.batchForm.teamName = obj.teamName;
                    this.batchForm.num = 1;
                    this.checkBatchDevice = []
                    this.batchDeviceDialog = true;
                    Vue.nextTick(function () {
                        app.$refs.otherList.clearSelection();
                        app.$refs.inputnum.resetnum('1.0');
                    })
                },
                /**
                 * 分批升级选择设备
                 */
                handleSelectBatch: function (val) {
                    this.checkBatchDevice = val;
                },
                /**
                 * 确定分批添加
                 */
                ensureaddBatches: function () {
                    if (this.checkBatchDevice.length == this.otherList.length) {
                        app.$message({
                            message: app.i18ns.upgradePlan.upgradePlan_batchUpgrade,
                            type: 'error'
                        });
                        return
                    }
                    this.batchDevice.pop()
                    this.batchDevice.push({
                        list: this.checkBatchDevice,
                        timeDelay: this.batchForm.num
                    })
                    var arr = _.filter(this.otherList.concat(this.checkBatchDevice), function (v, i, arr) {
                        return arr.indexOf(v) === arr.lastIndexOf(v);
                    })
                    if (arr.length > 0) {
                        this.batchDevice.push({
                            list: arr
                        })
                    }
                    this.batchDeviceDialog = false;
                },
                /**
                 * 设备中所属组
                 */
                getGroupTxt: function (group) {
                    if (group) {
                        if (typeof group == 'string') {
                            return group
                        } else if (Array.isArray(group)) {
                            return group.join(',')
                        } else {
                            return this.i18ns.upgradePlan.upgradePlan_nullGroup
                        }
                    } else {
                        return this.i18ns.upgradePlan.upgradePlan_nullGroup
                    }
                },
                /**
                 * 改变时间
                 */
                changeTime: function (val) {
                    var num = val.toFixed(1)
                    this.batchForm.num = num;
                },
                setnum: function (val) {
                    this.batchForm.num = val;
                },
                uniq: function (group, server) {
                    var arr = [];
                    if (server.length > 0 && group.length > 0) {
                        arr = JSON.parse(JSON.stringify(server));
                        _.each(group, function (item) {
                            if (!_.some(arr, function (ver) {
                                    return ver.ID == item.ID
                                })) {
                                arr.push(item)
                            }
                        })
                        return arr
                    } else if (group.length > 0 && server.length <= 0) {
                        return group;
                    } else if (server.length > 0 && group.length <= 0) {
                        return server;
                    } else {
                        return []
                    }
                },
                checkDataIsValid: function (params) {
                    if (params == undefined || params === "" || params == null) {
                        return false
                    } else {
                        return true
                    }
                },
                getSpTxt: function (SPVersion) {
                    var spVersion = [];
                    if (SPVersion) {
                        spVersion = [SPVersion.APPVersion, SPVersion.DataVersion, SPVersion.OSVersion];
                        spVersion.sort();
                        if ((this.checkDataIsValid(SPVersion.APPVersion) &&
                                this.checkDataIsValid(SPVersion.DataVersion) &&
                                this.checkDataIsValid(SPVersion.OSVersion)) || (!
                                this.checkDataIsValid(SPVersion.APPVersion) && !
                                this.checkDataIsValid(SPVersion.DataVersion) &&
                                !this.checkDataIsValid(SPVersion.OSVersion))) {
                            return spVersion[0];
                        } else {
                            for (var i = 0; i < spVersion.length; i++) {
                                if (spVersion[i] === '') {
                                    spVersion.splice(i, 1);
                                    i = i - 1;
                                }
                            }
                            return spVersion[0];
                        }
                    }
                },
                /**
                 * 升级包多版本复选框的选择
                 */
                 checkVersion:function(item) {
                    app.getGroupAndDevice()
                },
                /**
                * 精准升级
                */
                handleAccurate:function(row,index){
                    this.preciseId = '';
                    this.serverData = [];
                    this.managerData = [];
                    this.switchData = [];
                    this.fanData = [];
                    this.activeName='Server';
                    this.deviceName = row.HostName;
                    if(row.Devices&&row.Devices.length>0){
                        app.serverData=_.filter(row.Devices,function(item){
                            return item.DeviceType == 'Server'
                        });
                        app.managerData = _.filter(row.Devices,function(item){
                            return item.DeviceType == 'Manager'
                        });
                        app.switchData = _.filter(row.Devices,function(item){
                            return item.DeviceType == 'Switch'
                        });
                        app.fanData = _.filter(row.Devices,function(item){
                            return item.DeviceType != 'Server'&&item.DeviceType != 'Manager'&&item.DeviceType != 'Switch'
                        });
                        this.checkServer = _.filter(row.Devices,function(item){
                            return item.DeviceType == 'Server'&&item.Selected==true
                        });
                        this.checkManager = _.filter(row.Devices,function(item){
                            return item.DeviceType == 'Manager'&&item.Selected==true
                        });
                        this.checkSwitch = _.filter(row.Devices,function(item){
                            return item.DeviceType == 'Switch'&&item.Selected==true
                        });
                        this.checkFan = _.filter(row.Devices,function(item){
                            return item.DeviceType != 'Server'&&item.DeviceType != 'Manager'&&item.DeviceType != 'Switch'&&item.Selected==true
                        });
                    }
                    this.preciseId = row.ID;
                    this.preciseDialog = true;
                },
                /**
                 * 隐藏展开图标
                 */
                 getClassName: function (row, expandedRows) {
                    var res = [];
                    if (row.row.Firmwares && row.row.Firmwares.length == 1) {
                        res.push('row-expand-cover')
                    } else {
                        res.push('hide-padding')
                    }
                    return res.join(' ')
                },
                /**
                 * 精准升级弹窗--切换
                 */
                handleClick:function(){
                    var ref='';
                    if(this.activeName=='Server'){
                        ref= 'serverData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeName=='Manager'){
                        ref= 'managerData'
                        app.$refs['serverData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeName=='Switch'){
                        ref= 'switchData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['serverData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeName=='Fan'){
                        ref= 'fanData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['serverData'].hideFirmwares()
                    }
                    app.$refs[ref].handleClick()
                },
                handleDetailClick:function(){
                    var ref='';
                    if(this.activeDetail=='Server'){
                        ref= 'serverData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeDetail=='Manager'){
                        ref= 'managerData'
                        app.$refs['serverData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeDetail=='Switch'){
                        ref= 'switchData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['serverData'].hideFirmwares()
                        app.$refs['fanData'].hideFirmwares()
                    }else if(this.activeDetail=='Fan'){
                        ref= 'fanData'
                        app.$refs['managerData'].hideFirmwares()
                        app.$refs['switchData'].hideFirmwares()
                        app.$refs['serverData'].hideFirmwares()
                    }
                    app.$refs[ref].handleClick()
                },
                /**
                 * 选择行 发生变化
                 */
                 taskSelectionChange:function(val){
                    if(this.activeName=='Server'){
                        this.checkServer = val;
                    }
                    if(this.activeName=='Manager'){
                        this.checkManager = val;
                    }
                    if(this.activeName=='Switch'){
                        this.checkSwitch = val;
                    }
                    if(this.activeName=='Fan'){
                        this.checkFan = val;
                    }
                 },
                 /**
                  * 确定精准升级
                  */
                ensurePrecise:function(){
                    var devices = _.concat(this.checkServer,this.checkManager,this.checkSwitch,this.checkFan)
                    var i = _.findIndex(this.frameSrcData,function(item){
                        return item.ID == app.preciseId
                    })
                    var data = JSON.parse(JSON.stringify(this.serviceData))
                        this.frameSrcData[i].Devices=devices;
                    for (var k = 0; k < data.length; k++) {
                        if(data[k].ID == app.preciseId){
                            for (var t = 0; t < data[k].Devices.length; t++) {
                                data[k].Devices[t].Selected = false;
                                if(devices.length>0){
                                    for (var j = 0; j < devices.length; j++) {
                                        if(data[k].Devices[t].DeviceType==devices[j].DeviceType&&data[k].Devices[t].Index==devices[j].Index){
                                            data[k].Devices[t].Selected = true;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    this.serviceData = data;
                    this.preciseDialog = false;
                },
                /**
                 * 取消精准升级
                 */
                 canclepreciseDialog:function(){
                    this.preciseDialog = false;
                 },


            }
        });
    </script>
</body>

</html>